
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScorpioraFinal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/css/tempus-dominus.min.css" rel="stylesheet">
    <!-- Firebase App SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Database SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
           @font-face {
            font-family: 'SameeAvasThaana';
            src: url('fonts/Samee_Avas_Thaana.ttf');
        }
        
        /* Splash Screen Styles */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a9e5b 0%, #f8a31c 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        
        .splash-content {
            text-align: center;
            color: white;
        }
        
         .splash-logo {
            font-size: 5rem;
            font-weight: 800;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
            font-family: 'SameeAvasThaana', sans-serif;
        }
        
        .splash-logo span {
            color: #f9fff9;
        }
        
        .splash-tagline {
            font-size: 1.5rem;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 1s ease-in forwards;
            animation-delay: 0.5s;
        }
        
        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 auto;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            width: 0%;
            background: white;
            animation: loading 2s ease-in-out forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        /* Responsive adjustments for splash screen */
        @media (max-width: 768px) {
            .splash-logo {
                font-size: 3.5rem;
            }
            
            .splash-tagline {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .splash-logo {
                font-size: 2.8rem;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', Arial, sans-serif;
        }
        
        body {
            background-color: #f9fff9;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0 10px;
        }
        
        header {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .top-bar {
            display: flex;
            justify-content: center; /* Center the logo */
            align-items: center;
            padding: 15px 0;
            position: relative;
        }
        
        .logo {
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .logo h4 {
            color: #4a9e5b; /* Fresh green color */
            font-size: 24px;
            font-weight: bold;
        }
        
        .user-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
        }
        
        .user-actions a {
            color: #333;
            margin: 0 5px;
            font-size: 18px;
            text-decoration: none;
            position: relative;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #f8a31c; /* Orange accent color */
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none; /* Hidden by default */
        }
        
        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 24px;
            background: none;
            border: none;
            color: #4a9e5b;
            cursor: pointer;
            z-index: 101;
        }
        
        /* Mobile navigation */
        .mobile-nav {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 20px;
        }
        
        .mobile-nav.active {
            left: 0;
        }
        
        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .mobile-nav-header h4 {
            color: #4a9e5b;
            font-size: 20px;
        }
        
        .close-menu {
            background: none;
            border: none;
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .mobile-nav ul {
            list-style: none;
        }
        
        .mobile-nav ul li {
            margin-bottom: 10px;
        }
        
        .mobile-nav ul li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .mobile-nav ul li a:hover {
            background-color: #f0f9f1;
            color: #4a9e5b;
        }
        
        .mobile-nav ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        nav ul {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            padding: 10px 0;
        }
        
        nav ul li {
            margin: 5px;
        }
        
        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            padding: 5px 10px;
            white-space: nowrap;
        }
        
        nav ul li a:hover {
            color: #4a9e5b; /* Fresh green color */
        }
        
        /* NEW: All Catalog Button Styles */
        .all-catalog-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            padding: 12px 20px;
            cursor: pointer;
            margin: 5px 0;
        }
        
        .all-catalog-btn:hover {
            color: #4a9e5b;
            background-color: #f0f9f1;
        }
        
        .all-catalog-btn i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* NEW: Catalog List Styles */
        .catalog-full-list {
            display: none;
            padding: 10px 0;
            border-top: 1px solid #eee;
        }
        
        .catalog-full-list.active {
            display: block;
        }
        
        .catalog-full-list ul {
            list-style: none;
            padding-left: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .catalog-full-list li {
            margin-bottom: 8px;
        }
        
        .catalog-full-list a {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .catalog-full-list a:hover {
            background-color: #f0f9f1;
            color: #4a9e5b;
        }
        
        .catalog-full-list i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Banner Styles with Slideshow */
        .banner {
            margin: 15px 0;
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .slideshow {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            background-size: cover;
            background-position: center;
        }
        
        .slide.active {
            opacity: 1;
        }
        
        .banner-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.4);
        }
        
        .banner-text {
            text-align: center;
            color: white;
            padding: 20px;
            max-width: 80%;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.8s ease 0.3s;
        }
        
        .slide.active .banner-text {
            transform: translateY(0);
            opacity: 1;
        }
        
        .banner-text h2 {
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        
        .banner-text p {
            font-size: 18px;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        /* Guest House Page Styles */
        .guest-house-cover {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .guest-house-slideshow {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .guest-house-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            background-size: cover;
            background-position: center;
        }
        
        .guest-house-slide.active {
            opacity: 1;
        }
        
        .guest-house-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .guest-house-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .guest-house-subtitle {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }
        
        .guest-house-tagline {
            font-size: 1rem;
            font-style: italic;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        /* Gallery Button */
        .gallery-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: #f8a31c;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .gallery-button:hover {
            transform: scale(1.1);
            background-color: #e5940c;
        }
        
        .gallery-button i {
            font-size: 24px;
        }
        
        /* Gallery Modal */
        .gallery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .gallery-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-content {
            background-color: white;
            margin: 20px auto;
            border-radius: 8px;
            max-width: 800px;
            position: relative;
            animation: modalFadeIn 0.3s;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }
        
        .gallery-header h3 {
            color: #4a9e5b;
            margin: 0;
            font-size: 18px;
        }
        
        .close-gallery {
            background: none;
            border: none;
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .gallery-images {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .gallery-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .gallery-image:hover {
            transform: scale(1.05);
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Payment method styles */
        .payment-method {
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
        }
        
        .payment-method.selected {
            border-color: #4a9e5b; /* Fresh green color */
            background-color: #f0f9f1;
        }
        
        .payment-method label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .payment-method input[type="radio"] {
            margin-right: 8px;
        }
        
        .payment-method-details {
            margin-top: 8px;
            padding: 8px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #eee;
            display: none;
            font-size: 14px;
        }
        
        .payment-method.selected .payment-method-details {
            display: block;
        }
        
        .payment-logo {
            width: 80px;
            height: 40px;
            margin-left: 10px;
            object-fit: contain;
            background-color: white;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .bank-info {
            background-color: #f0f0f0;
            padding: 12px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 13px;
        }
        
        .bank-info p {
            margin-bottom: 5px;
        }
        
        .bank-account-number {
            cursor: pointer;
            position: relative;
            display: inline-block;
        }
        
        .bank-account-number:hover {
            color: #4a9e5b;
        }
        
        .bank-account-number::after {
            content: 'Click to copy';
            position: absolute;
            bottom: -20px;
            left: 0;
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .bank-account-number:hover::after {
            opacity: 1;
        }
        
        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4a9e5b;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copy-notification.show {
            opacity: 1;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            padding: 15px;
            text-align: center;
            border-radius: 4px;
            margin: 8px 0;
            cursor: pointer;
            font-size: 14px;
        }
        
        .upload-area:hover {
            border-color: #4a9e5b; /* Fresh green color */
        }
        
        .upload-area i {
            font-size: 36px;
            color: #ccc;
            margin-bottom: 8px;
        }
        
        .upload-area p {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .file-name {
            margin-top: 8px;
            font-size: 13px;
            color: #666;
        }
        
        /* Order confirmation styles */
        .order-confirmation {
            text-align: center;
            padding: 30px 15px;
            background-color: white;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .order-confirmation i {
            font-size: 50px;
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .order-confirmation h1 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .order-confirmation p {
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .order-details {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px auto;
            max-width: 100%;
            text-align: left;
            font-size: 14px;
        }
        
        .order-details h3 {
            margin-bottom: 12px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            font-size: 16px;
        }
        
        .order-details-row {
            display: flex;
            margin-bottom: 8px;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .order-details-label {
            font-weight: bold;
            width: 120px;
        }
        
        /* Pending review styles */
        .pending-review {
            text-align: center;
            padding: 30px 15px;
            background-color: white;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .pending-review i {
            font-size: 50px;
            color: #FFC107;
            margin-bottom: 15px;
        }
        
        .pending-review h1 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .pending-review p {
            margin-bottom: 15px;
            font-size: 16px;
        }

        /* Google Maps Styles */
        .location-section {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .location-section h2 {
            margin-bottom: 15px;
            color: #4a9e5b;
        }
        
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .location-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .location-details {
            flex: 1;
            min-width: 250px;
        }
        
        .location-details h3 {
            margin-bottom: 10px;
            color: #4a9e5b;
        }
        
        .location-details p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .location-details i {
            margin-right: 10px;
            color: #4a9e5b;
            width: 20px;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4a9e5b; /* Fresh green color */
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #3a7d48; /* Darker green */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background-color: #f8a31c; /* Orange accent color */
        }
        
        .btn-secondary:hover {
            background-color: #e5940c; /* Darker orange */
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 18px;
            width: 100%;
        }
        
        .categories, .featured-products, .product-listing {
            margin: 25px 0;
        }
        
        h2 {
            margin-bottom: 15px;
            font-size: 20px;
            color: #333;
            padding: 0 5px;
        }
        
        .category-grid, .product-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 10px;
            padding: 0 5px;
        }
        
        .category-item, .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .category-item:hover, .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .category-item img, .product-card img {
            width: 100%;
            height: 350px;
            object-fit: cover;
        }
        
        .category-item h3, .product-card h3 {
            padding: 10px;
            font-size: 14px;
        }
        
        .price {
            padding: 0 10px 10px;
        }
        
        .current-price {
            font-size: 16px;
            font-weight: bold;
            color: #4a9e5b; /* Fresh green color */
        }
        
        .original-price {
            font-size: 12px;
            text-decoration: line-through;
            color: #999;
            margin-left: 5px;
        }
        
        .product-actions {
            padding: 0 10px 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .product-filters {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .product-filters form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .product-filters input, .product-filters select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            font-size: 14px;
        }
        
        .product-detail {
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .product-image {
            padding: 15px;
            position: relative;
        }
        
        .product-image img {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
        }
        
        .close-detail {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-info h1 {
            font-size: 22px;
            margin-bottom: 8px;
        }
        
        .product-price {
            font-size: 20px;
            color: #4a9e5b; /* Fresh green color */
            margin: 10px 0;
        }
        
        .product-description {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .quantity-selector {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-selector input {
            width: 60px;
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        footer {
            background-color: #1a311e;
            color: white;
            padding: 25px 0;
            margin-top: 25px;
        }
        
        .footer-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .footer-section h3 {
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li {
            margin-bottom: 8px;
        }
        
        .footer-section ul li a {
            color: #ddd;
            text-decoration: none;
            font-size: 14px;
        }
        
        .footer-section ul li a:hover {
            color: #f8a31c; /* Orange accent color */
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
        }
        
        .social-icons a {
            color: white;
            font-size: 18px;
        }
        
        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid #2d4b32;
            font-size: 14px;
        }
        
        .developer-credit {
            margin-top: 10px;
            font-size: 12px;
            color: #aaa;
            text-align: center;
        }
        
        .developer-credit a {
            color: #f8a31c;
            text-decoration: none;
        }
        
        .developer-credit a:hover {
            text-decoration: underline;
        }
        
        .cart-items {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .cart-item {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-right: 10px;
        }
        
        .cart-item-details {
            flex: 1;
            min-width: 150px;
        }
        
        .cart-item-price {
            font-weight: bold;
            color: #4a9e5b; /* Fresh green color */
            margin: 5px 0;
            font-size: 14px;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .cart-item-quantity button {
            width: 25px;
            height: 25px;
            border: 1px solid #ddd;
            background: #f5f5f5;
            cursor: pointer;
            font-size: 14px;
        }
        
        .cart-item-quantity input {
            width: 40px;
            height: 25px;
            text-align: center;
            border: 1px solid #ddd;
            margin: 0 5px;
        }
        
        .cart-summary {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .summary-total {
            font-size: 16px;
            font-weight: bold;
            border-top: 1px solid #eee;
            padding-top: 8px;
            margin-top: 8px;
        }

        /* Checkout page styles */
        .checkout-columns {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .checkout-columns > div {
            width: 100%;
        }
        
        /* Shipping form styles - IMPROVED */
        .form-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .form-section h2 {
            color: #4a9e5b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input, 
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, 
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #4a9e5b;
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 158, 91, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .date-time-group {
            display: flex;
            gap: 15px;
        }
        
        .date-time-group .form-group {
            flex: 1;
        }
        
        /* Karaoke and Reservation Styles - IMPROVED */
        .booking-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .booking-option {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .booking-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: 1;
        }
        
        .booking-option.karaoke::before {
            background-image: url('https://images.unsplash.com/photo-1514525253161-7a46d19cd819?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80');
        }
        
        .booking-option.small-party::before {
            background-image: url('https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80');
        }
        
        .booking-option.office-gathering::before {
            background-image: url('https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80');
        }
        
        .booking-option.private-event::before {
            background-image: url('https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1769&q=80');
        }
        
        .booking-option.bbq::before {
            background-image: url('https://images.unsplash.com/photo-1551615593-ef5fe247e8f7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1800&q=80');
        }
        
        .booking-option > * {
            position: relative;
            z-index: 2;
            pointer-events: none;
        }
        
        .booking-option:hover {
            border-color: #4a9e5b;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }
        
        .booking-option.selected {
            border-color: #4a9e5b;
            background-color: #f0f9f1;
        }
        
        .booking-option i {
            font-size: 32px;
            color: #4a9e5b;
            margin-bottom: 10px;
        }
        
        .booking-form {
            margin-top: 25px;
            display: none;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .booking-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .booking-summary {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
            display: none;
        }
        
        .booking-summary h3 {
            margin-bottom: 15px;
            color: #4a9e5b;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        /* Order status tracking */
        .order-status {
            margin: 15px 0;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .status-timeline {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            position: relative;
        }
        
        .status-timeline::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }
        
        .status-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .status-icon.active {
            background-color: #4a9e5b;
            color: white;
        }
        
        .status-label {
            font-size: 12px;
            text-align: center;
        }
        
        .status-tracker-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-tracker-form input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* NEW STYLES FOR CATEGORIES AND PRODUCTS */
        .category-item {
            position: relative;
            text-align: center;
        }
        
        .category-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .category-item:hover .category-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.6);
        }
        
        .category-title {
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        
        .product-card {
            position: relative;
        }
        
        .product-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .product-card:hover .product-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.6);
        }
        
        .product-actions-overlay {
            display: flex;
            gap: 10px;
        }
        
        .catalog-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }
        
        .catalog-menu.active {
            right: 0;
            display: block;
        }
        
        .catalog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .catalog-header h4 {
            color: #4a9e5b;
            font-size: 20px;
        }
        
        .close-catalog {
            background: none;
            border: none;
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .catalog-list {
            list-style: none;
            padding: 0;
        }
        
        .catalog-list li {
            margin-bottom: 10px;
        }
        
        .catalog-list li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .catalog-list li a:hover {
            background-color: #f0f9f1;
            color: #4a9e5b;
        }
        
        .catalog-list li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .catalog-btn {
            background: none;
            border: none;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .catalog-btn:hover {
            color: #4a9e5b;
        }
        
        /* Points System Styles - IMPROVED */
        .points-section {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .points-balance {
            font-size: 20px;
            font-weight: bold;
            color: #4a9e5b;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f9f1;
            border-radius: 8px;
            text-align: center;
        }
        
        .points-check-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .points-check-form input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .points-history {
            margin-top: 25px;
            display: none;
        }
        
        .points-history-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .points-history-item:last-child {
            border-bottom: none;
        }
        
        .points-date {
            font-size: 12px;
            color: #888;
        }
        
        .redeem-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .redeem-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .redeem-option {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 220px;
            position: relative;
            overflow: hidden;
        }
        
        .redeem-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            opacity: 0.2;
            z-index: 1;
        }
        
        .redeem-option:hover {
            border-color: #4a9e5b;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }
        
        .redeem-option.selected {
            border-color: #4a9e5b;
            background-color: #f0f9f1;
        }
        
        .redeem-option > * {
            position: relative;
            z-index: 2;
        }
        
        .redeem-option img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 15px;
        }
        
        .redeem-option h4 {
            margin-bottom: 10px;
            color: #4a9e5b;
            font-size: 16px;
        }
        
        .redeem-option p {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            flex-grow: 1;
        }
        
        .redeem-option .points-cost {
            font-weight: bold;
            color: #f8a31c;
            font-size: 18px;
            margin-top: 10px;
        }
        
        /* Product Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            margin: 20px auto;
            border-radius: 8px;
            max-width: 800px;
            position: relative;
            animation: modalFadeIn 0.3s;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #333;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 10;
        }
        
        /* NEW: Simplified Checkout Styles */
        .simplified-checkout {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .order-tracking-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tracking-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .tracking-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .tracking-option.active {
            border-color: #4a9e5b;
            background-color: #f0f9f1;
        }
        
        .tracking-option i {
            font-size: 24px;
            color: #4a9e5b;
            margin-bottom: 10px;
        }
        
        /* Welcome Bonus Modal */
        .welcome-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .welcome-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .welcome-content {
            background-color: white;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            padding: 30px;
            text-align: center;
            position: relative;
            animation: modalFadeIn 0.3s;
        }
        
        .welcome-content h2 {
            color: #4a9e5b;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .welcome-content p {
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .welcome-content input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        /* Redemption Confirmation Styles */
        .redemption-confirmation {
            text-align: center;
            padding: 30px 20px;
            background-color: white;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .redemption-confirmation i {
            font-size: 60px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        .redemption-confirmation h1 {
            margin-bottom: 15px;
            color: #4a9e5b;
            font-size: 28px;
        }
        
        .redemption-details {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 100%;
            text-align: left;
        }
        
        .redemption-details h3 {
            margin-bottom: 15px;
            color: #4a9e5b;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .reference-number {
            font-size: 24px;
            font-weight: bold;
            color: #4a9e5b;
            margin: 15px 0;
            padding: 10px;
            background-color: #f0f9f1;
            border-radius: 4px;
            display: inline-block;
        }
        
        .status-check-info {
            margin-top: 25px;
            padding: 15px;
            background-color: #f0f9f1;
            border-radius: 8px;
        }
        
        /* Registration Prompt Styles */
        .registration-prompt {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .registration-prompt h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .registration-prompt p {
            margin-bottom: 15px;
            color: #856404;
            font-size: 14px;
        }
        
        /* Booking Confirmation Styles */
        .booking-confirmation {
            text-align: center;
            padding: 30px 20px;
            background-color: white;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .booking-confirmation i {
            font-size: 60px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        .booking-confirmation h1 {
            margin-bottom: 15px;
            color: #4a9e5b;
            font-size: 28px;
        }
        
        .booking-details {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 100%;
            text-align: left;
        }
        
        .booking-details h3 {
            margin-bottom: 15px;
            color: #4a9e5b;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        /* Calendar Styles */
        .calendar-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background-color: #f0f9f1;
            border-radius: 4px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            background-color: #f0f9f1;
        }
        
        .calendar-day.available {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .calendar-day.unavailable {
            background-color: #ffebee;
            color: #c62828;
            cursor: not-allowed;
        }
        
        .calendar-day.selected {
            background-color: #4a9e5b;
            color: white;
        }
        
        .calendar-day.today {
            border: 2px solid #f8a31c;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .time-slot {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-slot:hover {
            background-color: #f0f9f1;
        }
        
        .time-slot.selected {
            background-color: #4a9e5b;
            color: white;
            border-color: #4a9e5b;
        }
        
        .time-slot.unavailable {
            background-color: #ffebee;
            color: #c62828;
            cursor: not-allowed;
        }
        
        /* Login/Register Modal Styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .auth-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-content {
            background-color: white;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            padding: 30px;
            position: relative;
            animation: modalFadeIn 0.3s;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .auth-tab.active {
            border-bottom: 2px solid #4a9e5b;
            color: #4a9e5b;
            font-weight: bold;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .auth-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        
        .auth-message.success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }

        .auth-message.error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }

        /* Guest House Booking Styles */
        .room-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .room-option {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .room-option:hover {
            border-color: #4a9e5b;
        }

        .room-option.selected {
            border-color: #4a9e5b;
            background-color: #f0f9f1;
        }

        .room-option h4 {
            margin-bottom: 10px;
            color: #4a9e5b;
        }

        .room-option .room-price {
            font-weight: bold;
            margin: 10px 0;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .amenity-item {
            display: flex;
            align-items: center;
        }

        .amenity-item input {
            margin-right: 8px;
        }

        .date-selection {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .date-selection .form-group {
            flex: 1;
        }

        .guest-house-summary {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-total {
            font-weight: bold;
            border-top: 1px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Duration Selector Styles */
        .duration-selector {
            margin: 15px 0;
        }

        .duration-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .duration-option {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .duration-option:hover {
            border-color: #4a9e5b;
        }

        .duration-option.selected {
            border-color: #4a9e5b;
            background-color: #f0f9f1;
            color: #4a9e5b;
            font-weight: bold;
        }

        /* Event Pricing Styles */
        .event-pricing {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .pricing-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .pricing-total {
            font-weight: bold;
            border-top: 1px solid #ddd;
            padding-top: 8px;
            margin-top: 8px;
        }

        /* Booking History Styles */
        .booking-history {
            margin-top: 20px;
        }

        .booking-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .booking-ref {
            font-weight: bold;
            color: #4a9e5b;
        }

        .booking-date {
            color: #666;
            font-size: 14px;
        }

        .booking-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background-color: #d4edda;
            color: #155724;
        }

        .status-completed {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }

        .booking-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .booking-detail {
            font-size: 14px;
        }

        .booking-detail-label {
            font-weight: bold;
            color: #666;
        }

        /* History Page Styles */
        .history-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .history-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .history-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .history-tab.active {
            border-bottom: 2px solid #4a9e5b;
            color: #4a9e5b;
            font-weight: bold;
        }

        .history-content {
            display: none;
        }

        .history-content.active {
            display: block;
        }

        .history-item {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-item-date {
            color: #666;
            font-size: 14px;
        }

        .history-item-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .history-item-detail {
            font-size: 14px;
        }

        .history-item-detail-label {
            font-weight: bold;
            color: #666;
        }

        .no-history {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        /* Desktop styles */
        @media (min-width: 768px) {
            .container {
                width: 90%;
                max-width: 1200px;
                padding: 0 15px;
            }
            
            .top-bar {
                flex-direction: row;
                align-items: center;
                padding: 15px 0;
            }
            
            .logo {
                text-align: center;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .user-actions {
                position: absolute;
                top: 15px;
                right: 15px;
                margin-top: 0;
            }
            
            .category-grid, .product-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
            
            .product-detail {
                flex-direction: row;
            }
            
            .footer-sections {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .checkout-columns {
                flex-direction: row;
            }
            
            .product-actions {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .banner {
                height: 400px;
            }
            
            .banner-text h2 {
                font-size: 36px;
            }
            
            .banner-text p {
                font-size: 20px;
            }
            
            .booking-options {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .redeem-options {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .location-info {
                flex-direction: row;
            }
            
            .tracking-options {
                flex-direction: row;
            }
            
            .guest-house-cover {
                height: 500px;
            }
            
            .guest-house-title {
                font-size: 4rem;
            }
            
            .guest-house-subtitle {
                font-size: 2rem;
            }
            
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .time-slots {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .gallery-images {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .booking-details-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .history-item-details {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Mobile landscape and tablet portrait */
        @media (min-width: 480px) and (max-width: 767px) {
            .banner {
                height: 250px;
            }
            
            .banner-text h2 {
                font-size: 24px;
            }
            
            .banner-text p {
                font-size: 16px;
            }
            
            .booking-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .redeem-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tracking-options {
                flex-direction: column;
            }
            
            .guest-house-cover {
                height: 350px;
            }
            
            .guest-house-title {
                font-size: 2.5rem;
            }
            
            .guest-house-subtitle {
                font-size: 1.5rem;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .gallery-images {
                grid-template-columns: repeat(2, 1fr);
            }

            .history-item-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile styles */
        @media (max-width: 767px) {
            .mobile-menu-btn {
                display: block;
            }
            
            nav ul {
                display: none;
            }
            
            .top-bar {
                padding-top: 50px;
            }
            
            .category-grid, .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .booking-options {
                grid-template-columns: 1fr;
            }
            
            .redeem-options {
                grid-template-columns: 1fr;
            }
            
            .location-info {
                flex-direction: column;
            }
            
            .modal-content {
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            .tracking-options {
                flex-direction: column;
            }
            
            .guest-house-cover {
                height: 300px;
            }
            
            .guest-house-title {
                font-size: 2rem;
            }
            
            .guest-house-subtitle {
                font-size: 1.2rem;
            }
            
            .date-time-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .points-check-form {
                flex-direction: column;
            }
            
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .room-options {
                grid-template-columns: 1fr;
            }
            
            .gallery-images {
                grid-template-columns: 1fr;
            }
            
            .booking-details-grid {
                grid-template-columns: 1fr;
            }

            .history-item-details {
                grid-template-columns: 1fr;
            }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
            .category-grid, .product-grid {
                grid-template-columns: 1fr;
            }
            
            .banner {
                height: 200px;
            }
            
            .banner-text h2 {
                font-size: 20px;
            }
            
            .banner-text p {
                font-size: 14px;
            }
            
            .booking-options {
                grid-template-columns: 1fr;
            }
            
            .booking-option {
                height: 150px;
            }
            
            .redeem-options {
                grid-template-columns: 1fr;
            }
            
            .guest-house-cover {
                height: 250px;
            }
            
            .guest-house-title {
                font-size: 1.8rem;
            }
            
            .guest-house-subtitle {
                font-size: 1rem;
            }
            
            .time-slots {
                grid-template-columns: 1fr;
            }
            
            .duration-options {
                flex-direction: column;
            }
        }
    </style>
   
</head>
<body>
    
   <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">arOwipOkqs<span></span></div>
            <p class="splash-tagline">Bold by Mystery. Driven by Nature!</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-modal" id="closeAuthModal" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
            <h2 style="text-align: center; margin-bottom: 20px; color: #4a9e5b;">Welcome to Scorpiora!</h2>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="register">Register</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <input type="text" id="loginPhone" placeholder="Phone Number" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button class="btn" id="loginBtn" style="width: 100%;">Login</button>
                <div class="auth-message" id="loginMessage"></div>
            </div>
            
            <div class="auth-form" id="registerForm">
                <input type="text" id="registerName" placeholder="Full Name" required>
                <input type="text" id="registerPhone" placeholder="Phone Number" required>
                <input type="password" id="registerPassword" placeholder="Password" required>
                <input type="password" id="registerConfirmPassword" placeholder="Confirm Password" required>
                <button class="btn" id="registerBtn" style="width: 100%;">Register & Get 100 Points</button>
                <div class="auth-message" id="registerMessage"></div>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div class="gallery-modal" id="galleryModal">
        <div class="gallery-content">
            <div class="gallery-header">
                <h3>Guest House Gallery</h3>
                <button class="close-gallery" id="closeGallery">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="gallery-images" id="galleryImages">
                <!-- Gallery images will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Copy Notification -->
    <div class="copy-notification" id="copyNotification">
        Account number copied to clipboard!
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content" id="modalContent">
            <button class="close-modal" id="closeModal">
                <i class="fas fa-times"></i>
            </button>
            <!-- Modal content will be loaded here -->
        </div>
    </div>

    <header>
        <div class="container">
            <!-- Mobile menu button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="top-bar">
                <div class="logo">
                    <h4>Scorpiora</h4>
                </div>
                
                <div class="user-actions">
                    <a href="#" id="cartLink"><i class="fas fa-shopping-cart"></i> 
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                    <a href="#" id="pointsLink"><i class="fas fa-coins"></i></a>
                    <a href="#" id="userLink"><i class="fas fa-user"></i></a>
                    <a href="admin.html" id="adminLink" style="display: none;"><i class="fas fa-cog"></i></a>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="products">Our Products</a></li>
                    <li><button class="catalog-btn" id="catalogBtn">Catalog</button></li>
                    <ul class="catalog-list" id="catalogList">
            <!-- Categories will be loaded dynamically -->
        </ul>
                    <li><a href="#" class="nav-link" data-page="guest-house">Guest House</a></li>
                    <li><a href="#" class="nav-link" data-page="booking">Exclusive Reservations</a></li>
                    <li><a href="#" class="nav-link" data-page="order-status">Order Status</a></li>
                    <li><a href="#" class="nav-link" data-page="points">Redeem Points</a></li>
                    <li><a href="#" class="nav-link" data-page="location">Location</a></li>
                    <li><a href="#" class="nav-link" data-page="history">History</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Catalog Menu -->
    <div class="catalog-menu" id="catalogMenu">
        <div class="catalog-header">
            <h4>Product Catalog</h4>
            <button class="close-catalog" id="closeCatalog">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="catalog-list" id="catalogList">
            <!-- Categories will be loaded dynamically -->
        </ul>
        <!-- NEW: All Catalog Button -->
        <button class="all-catalog-btn" id="allCatalogBtn">
            <i class="fas fa-list"></i> All Catalog
        </button>
        <!-- NEW: Catalog Full List -->
        <div class="catalog-full-list" id="catalogFullList">
            <!-- Full catalog will be loaded here -->
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-header">
            <h4>Scorpiora</h4>
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul>
            <li><a href="#" class="mobile-nav-link" data-page="home"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" class="mobile-nav-link" data-page="products"><i class="fas fa-glass"></i> Our Products</a></li>
             
            <li><a href="#" class="mobile-nav-link" data-page="guest-house"><i class="fas fa-bed"></i> Guest House</a></li>
            <li><a href="#" class="mobile-nav-link" data-page="booking"><i class="fas fa-calendar-alt"></i> Exclusive Reservations</a></li>
            
            <li><a href="#" class="mobile-nav-link" data-page="order-status"><i class="fas fa-truck"></i> Order Status</a></li>
            <li><a href="#" class="mobile-nav-link" data-page="points"><i class="fas fa-coins"></i> Redeem Points</a></li>
            <li><a href="#" class="mobile-nav-link" data-page="location"><i class="fas fa-map-marker-alt"></i> Location</a></li>
            <li><a href="#" class="mobile-nav-link" data-page="history"><i class="fas fa-history"></i> History</a></li>
            <!-- Dynamic categories will be added here -->
            <div id="mobileDynamicCategories"></div>
        </ul>
    </div>

    <!-- Overlay for mobile menu -->
    <div class="overlay" id="overlay"></div>

    <main class="container" id="mainContent">
        <!-- Content will be dynamically loaded here -->
    </main>

    <footer>
        <div class="container">
            <div class="footer-sections">
               
                <div class="footer-section">
                    <h3>Follow Us</h3>
                    <div class="social-icons">
                        <a href="https://www.instagram.com/scorpiora_cs?igsh=MXBjem9zN3diaXF0ag=="><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; <span id="currentYear"></span> Scorpiora. All rights reserved.</p>
                <div class="developer-credit">
                    Developed by <a href="#" target="_blank">sym.codermv</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAWZhhfPQYjYWgRizSlC8CgXmw7p-etF_k",
            authDomain: "testfile-d4e33.firebaseapp.com",
            projectId: "testfile-d4e33",
            storageBucket: "testfile-d4e33.firebasestorage.app",
            messagingSenderId: "506950055235",
            appId: "1:506950055235:web:3b4777aa5f63771ad0ebf6",
            measurementId: "G-HYRNNJ4YRQ"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // App state
        let state = {
            cart: JSON.parse(localStorage.getItem('cart')) || {},
            currentPage: 'home',
            currentCategory: null,
            currentSearch: '',
            currentProduct: null,
            orderDetails: null,
            paymentMethod: null,
            uploadedFile: null,
            products: [],
            smoothies: [],
            discountPercentage: 0,
            categories: ["Fresh Juices", "Smoothies", "Detox Cleanses", "Boosters", "Wellness Shots"],
            catalogName: "Fresh Juice Bar",
            freeShippingThreshold: 100, // Free shipping threshold in MVR
            shippingCost: 5.99, // Standard shipping cost
            bookingType: null,
            bookingDetails: null,
            pointsProducts: [
                {
                    id: 'points-100',
                    name: '100 Points Reward',
                    points: 100,
                    description: 'Get any product under MVR 100 for free',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    maxValue: 100,
                    backgroundImage: 'https://images.unsplash.com/photo-1613478223719-2ab802602423?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-270',
                    name: '270 Points Reward',
                    points: 270,
                    description: 'Get any product under MVR 270 for free',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    maxValue: 270,
                    backgroundImage: 'https://images.unsplash.com/photo-1571934811356-5cc061b6821f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-500',
                    name: '500 Points Reward',
                    points: 500,
                    description: 'Get any product under MVR 500 for free',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    maxValue: 500,
                    backgroundImage: 'https://images.unsplash.com/photo-1615478503562-ec2d8aa0e24e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-karaoke',
                    name: 'Karaoke Session',
                    points: 800,
                    description: 'Free 2-hour karaoke session',
                    image: 'https://cdn-icons-png.flaticon.com/512/2990/2990682.png',
                    bookingType: 'karaoke',
                    backgroundImage: 'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-party',
                    name: 'Small Party Package',
                    points: 1500,
                    description: 'Free small party package for up to 10 people',
                    image: 'https://cdn-icons-png.flaticon.com/512/3296/3296414.png',
                    bookingType: 'small-party',
                    backgroundImage: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                }
            ],
            customerPoints: 0,
            customerPhone: localStorage.getItem('customerPhone') || '',
            customerName: localStorage.getItem('customerName') || '',
            isLoggedIn: localStorage.getItem('isLoggedIn') === 'true',
            guestHouseImages: [
                'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80',
                'https://images.unsplash.com/photo-1582719508461-905c673771fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80',
                'https://images.unsplash.com/photo-1566665797739-1674de7a421a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80',
                'https://images.unsplash.com/photo-1582582621959-48d27397dc69?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1769&q=80',
                'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80'
            ],
            guestHousePointsProducts: [
                {
                    id: 'points-100',
                    name: '100 Points Reward',
                    points: 100,
                    description: 'Get 10% discount on your booking',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    discount: 10,
                    backgroundImage: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-270',
                    name: '270 Points Reward',
                    points: 270,
                    description: 'Get 25% discount on your booking',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    discount: 25,
                    backgroundImage: 'https://images.unsplash.com/photo-1582719508461-905c673771fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                },
                {
                    id: 'points-500',
                    name: '500 Points Reward',
                    points: 500,
                    description: 'Get 50% discount on your booking',
                    image: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    discount: 50,
                    backgroundImage: 'https://images.unsplash.com/photo-1566665797739-1674de7a421a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
                }
            ],
            pointsRedemption: false,
            pointsRedemptionProduct: null,
            selectedBookingDate: null,
            selectedTimeSlot: null,
            guestHouseAvailability: {},
            roomTypes: [
                {
                    id: 'deluxe',
                    name: 'Deluxe Room',
                    price: 1500,
                    description: 'Comfortable room with all basic amenities',
                    image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80'
                },
                {
                    id: 'super-deluxe',
                    name: 'Super Deluxe Room',
                    price: 2500,
                    description: 'Spacious room with premium amenities',
                    image: 'https://images.unsplash.com/photo-1582582621959-48d27397dc69?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1769&q=80'
                }
            ],
            amenities: [
                { id: 'hair-dryer', name: 'Hair Dryer', price: 0 },
                { id: 'hot-water', name: 'Hot Water', price: 0 },
                { id: 'mini-bar', name: 'Mini Bar', price: 500 },
                { id: 'iron', name: 'Iron', price: 0 },
                { id: 'cable-tv', name: 'Cable TV', price: 0 },
                { id: 'wifi', name: 'WiFi', price: 0 },
                { id: 'bath-tub', name: 'Bath Tub', price: 500 },
                { id: 'breakfast', name: 'Breakfast', price: 300 }
            ],
            selectedRoom: null,
            selectedAmenities: [],
            checkInDate: null,
            checkOutDate: null,
            eventPricing: {
                'karaoke': [
                    { hours: 1, price: 500 },
                    { hours: 2, price: 900 },
                    { hours: 3, price: 1200 },
                    { hours: 4, price: 1500 }
                ],
                'small-party': [
                    { hours: 2, price: 1500 },
                    { hours: 4, price: 2500 },
                    { hours: 6, price: 3500 }
                ],
                'office-gathering': [
                    { hours: 3, price: 2000 },
                    { hours: 5, price: 3000 },
                    { hours: 8, price: 4500 }
                ],
                'private-event': [
                    { hours: 4, price: 3000 },
                    { hours: 6, price: 4000 },
                    { hours: 8, price: 5000 }
                ]
            },
            selectedEventDuration: null,
            bookingHistory: [],
            orderHistory: []
        };

        // DOM elements
        const mainContent = document.getElementById('mainContent');
        const cartCount = document.getElementById('cartCount');
        const cartLink = document.getElementById('cartLink');
        const pointsLink = document.getElementById('pointsLink');
        const userLink = document.getElementById('userLink');
        const adminLink = document.getElementById('adminLink');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
        const currentYear = document.getElementById('currentYear');
        const splashScreen = document.getElementById('splash-screen');
        const mobileDynamicCategories = document.getElementById('mobileDynamicCategories');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileNav = document.getElementById('mobileNav');
        const closeMenu = document.getElementById('closeMenu');
        const overlay = document.getElementById('overlay');
        const catalogBtn = document.getElementById('catalogBtn');
        const catalogMenu = document.getElementById('catalogMenu');
        const closeCatalog = document.getElementById('closeCatalog');
        const catalogList = document.getElementById('catalogList');
        const productModal = document.getElementById('productModal');
        const modalContent = document.getElementById('modalContent');
        const closeModal = document.getElementById('closeModal');
        const copyNotification = document.getElementById('copyNotification');
        const allCatalogBtn = document.getElementById('allCatalogBtn');
        const catalogFullList = document.getElementById('catalogFullList');
        const authModal = document.getElementById('authModal');
        const closeAuthModal = document.getElementById('closeAuthModal');
        const authTabs = document.querySelectorAll('.auth-tab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const loginMessage = document.getElementById('loginMessage');
        const registerMessage = document.getElementById('registerMessage');
        const galleryModal = document.getElementById('galleryModal');
        const closeGallery = document.getElementById('closeGallery');
        const galleryImages = document.getElementById('galleryImages');

        // Initialize the app
        function init() {
            // Set current year in footer
            currentYear.textContent = new Date().getFullYear();

            // Hide splash screen after 3 seconds
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    loadCatalogName();
                    loadCategories();
                    loadProducts();
                    loadSmoothies();
                    loadDiscount();
                    loadShippingSettings();
                    loadGuestHouseAvailability();
                    loadBookingHistory();
                    loadOrderHistory();
                    
                    // Show auth modal if not logged in
                    if (!state.isLoggedIn) {
                        setTimeout(() => {
                            authModal.classList.add('active');
                        }, 1000);
                    } else {
                        // If logged in, check their points
                        checkCustomerPoints(state.customerPhone);
                    }
                    
                    // Update UI based on login status
                    updateUIForLoginStatus();
                }, 500);
            }, 3000);

            // Add event listeners for navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    const category = link.dataset.category;
                    
                    if (category) {
                        state.currentCategory = category;
                        state.currentSearch = '';
                    }
                    
                    loadPage(page);
                });
            });

            // Add event listeners for mobile navigation
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    const category = link.dataset.category;
                    
                    if (category) {
                        state.currentCategory = category;
                        state.currentSearch = '';
                    }
                    
                    loadPage(page);
                    closeMobileMenu();
                });
            });

            cartLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (!state.isLoggedIn) {
                    authModal.classList.add('active');
                    return;
                }
                loadPage('cart');
                closeMobileMenu();
            });

            pointsLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (!state.isLoggedIn) {
                    authModal.classList.add('active');
                    return;
                }
                loadPage('points');
                closeMobileMenu();
            });

            userLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (state.isLoggedIn) {
                    // Show logout option
                    if (confirm('Do you want to logout?')) {
                        logout();
                    }
                } else {
                    authModal.classList.add('active');
                }
            });

            adminLink.addEventListener('click', (e) => {
                e.preventDefault();
                // Admin link now goes to admin.html
                window.location.href = 'admin.html';
            });

            // Mobile menu functionality
            mobileMenuBtn.addEventListener('click', openMobileMenu);
            closeMenu.addEventListener('click', closeMobileMenu);
            overlay.addEventListener('click', closeMobileMenu);

            // Catalog menu functionality
            catalogBtn.addEventListener('click', openCatalogMenu);
            closeCatalog.addEventListener('click', closeCatalogMenu);
            overlay.addEventListener('click', closeCatalogMenu);
            
            // All Catalog button functionality
            allCatalogBtn.addEventListener('click', toggleFullCatalog);
            
            // Modal functionality
            closeModal.addEventListener('click', closeProductModal);
            productModal.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    closeProductModal();
                }
            });
            
            // Auth modal functionality
            closeAuthModal.addEventListener('click', closeAuthModalFunc);
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    closeAuthModalFunc();
                }
            });
            
            // Auth tabs functionality
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // Update active tab
                    authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding form
                    if (tabName === 'login') {
                        loginForm.classList.add('active');
                        registerForm.classList.remove('active');
                    } else {
                        loginForm.classList.remove('active');
                        registerForm.classList.add('active');
                    }
                });
            });
            
            // Login functionality
            loginBtn.addEventListener('click', loginUser);
            
            // Register functionality
            registerBtn.addEventListener('click', registerUser);
            
            // Gallery modal functionality
            closeGallery.addEventListener('click', closeGalleryModal);
            galleryModal.addEventListener('click', (e) => {
                if (e.target === galleryModal) {
                    closeGalleryModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeProductModal();
                    closeAuthModalFunc();
                    closeGalleryModal();
                }
            });
            
            // Initialize cart count
            updateCartCount();
            
            // Load home page by default
            loadPage('home');
        }

        // Update UI based on login status
        function updateUIForLoginStatus() {
            if (state.isLoggedIn) {
                userLink.innerHTML = `<i class="fas fa-user"></i> ${state.customerName}`;
                adminLink.style.display = state.customerPhone === 'admin' ? 'block' : 'none';
            } else {
                userLink.innerHTML = '<i class="fas fa-user"></i>';
                adminLink.style.display = 'none';
            }
        }

        // Logout function
        function logout() {
            state.isLoggedIn = false;
            state.customerPhone = '';
            state.customerName = '';
            state.customerPoints = 0;
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('customerPhone');
            localStorage.removeItem('customerName');
            updateUIForLoginStatus();
            authModal.classList.add('active');
        }

        // Close auth modal
        function closeAuthModalFunc() {
            authModal.classList.remove('active');
        }

        // Close gallery modal
        function closeGalleryModal() {
            galleryModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Open gallery modal
        function openGalleryModal() {
            // Load gallery images
            galleryImages.innerHTML = '';
            state.guestHouseImages.forEach(image => {
                const imgElement = document.createElement('img');
                imgElement.src = image;
                imgElement.alt = 'Guest House Image';
                imgElement.className = 'gallery-image';
                galleryImages.appendChild(imgElement);
            });
            
            galleryModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Login user
        function loginUser() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!phone || !password) {
                showMessage(loginMessage, 'Please fill all fields', 'error');
                return;
            }
            
            // Check if user exists
            database.ref('customers').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const customerData = Object.values(snapshot.val())[0];
                        
                        // Check password (in a real app, you should use proper password hashing)
                        if (customerData.password === password) {
                            // Login successful
                            state.isLoggedIn = true;
                            state.customerPhone = phone;
                            state.customerName = customerData.name;
                            localStorage.setItem('isLoggedIn', 'true');
                            localStorage.setItem('customerPhone', phone);
                            localStorage.setItem('customerName', customerData.name);
                            
                            // Check points
                            checkCustomerPoints(phone);
                            
                            // Update UI
                            updateUIForLoginStatus();
                            
                            // Close modal
                            closeAuthModalFunc();
                            
                            // Show welcome message
                            alert(`Welcome back, ${customerData.name}!`);
                        } else {
                            showMessage(loginMessage, 'Invalid password', 'error');
                        }
                    } else {
                        showMessage(loginMessage, 'User not found. Please register.', 'error');
                    }
                })
                .catch(error => {
                    showMessage(loginMessage, 'Error: ' + error.message, 'error');
                });
        }

        // Register user
        function registerUser() {
            const name = document.getElementById('registerName').value.trim();
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!name || !phone || !password || !confirmPassword) {
                showMessage(registerMessage, 'Please fill all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage(registerMessage, 'Passwords do not match', 'error');
                return;
            }
            
            // Check if phone number already exists
            database.ref('customers').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showMessage(registerMessage, 'Phone number already registered', 'error');
                        return;
                    }
                    
                    // Add new customer
                    database.ref('customers').push({
                        name: name,
                        phone: phone,
                        password: password, // In a real app, you should hash the password
                        registeredAt: new Date().toISOString()
                    }).then(() => {
                        // Add 100 welcome points
                        database.ref('customerPoints').push({
                            phone: phone,
                            points: 100,
                            firstOrder: new Date().toISOString(),
                            welcomeBonus: true
                        }).then(() => {
                            // Registration successful
                            state.isLoggedIn = true;
                            state.customerPhone = phone;
                            state.customerName = name;
                            state.customerPoints = 100;
                            localStorage.setItem('isLoggedIn', 'true');
                            localStorage.setItem('customerPhone', phone);
                            localStorage.setItem('customerName', name);
                            
                            // Update UI
                            updateUIForLoginStatus();
                            
                            // Close modal
                            closeAuthModalFunc();
                            
                            // Show success message
                            showMessage(registerMessage, 'Registration successful! 100 points added to your account.', 'success');
                            setTimeout(() => {
                                alert(`Welcome to Scorpiora, ${name}! You've received 100 bonus points.`);
                            }, 1000);
                        });
                    });
                })
                .catch(error => {
                    showMessage(registerMessage, 'Error: ' + error.message, 'error');
                });
        }

        // Show message in auth forms
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = 'auth-message ' + type;
        }

        // Check customer points
        function checkCustomerPoints(phone) {
            database.ref('customerPoints').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const customerData = Object.values(snapshot.val())[0];
                        state.customerPoints = customerData.points || 0;
                        
                        // Update points display if on points page
                        if (state.currentPage === 'points') {
                            const pointsResult = document.getElementById('pointsResult');
                            if (pointsResult) {
                                pointsResult.innerHTML = `
                                    <div style="background-color: #f0f9f1; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                        <h3 style="color: #4a9e5b; margin-bottom: 10px;">Points Balance</h3>
                                        <div style="font-size: 24px; font-weight: bold; color: #4a9e5b;">${state.customerPoints} points</div>
                                        <p style="margin-top: 10px; font-size: 14px;">You can redeem your points for rewards below!</p>
                                    </div>
                                `;
                            }
                        }
                    }
                });
        }

        // Load booking history for the current user
        function loadBookingHistory() {
            if (!state.isLoggedIn) return;
            
            // Load event bookings
            database.ref('bookingRequests').orderByChild('phone').equalTo(state.customerPhone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const bookings = Object.entries(snapshot.val()).map(([key, value]) => {
                            return { id: key, ...value, type: 'event' };
                        });
                        state.bookingHistory = [...state.bookingHistory, ...bookings];
                    }
                });
            
            // Load guest house bookings
            database.ref('guestHouseBookings').orderByChild('contact').equalTo(state.customerPhone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const bookings = Object.entries(snapshot.val()).map(([key, value]) => {
                            return { id: key, ...value, type: 'guesthouse' };
                        });
                        state.bookingHistory = [...state.bookingHistory, ...bookings];
                    }
                });
        }

        // Load order history for the current user
        function loadOrderHistory() {
            if (!state.isLoggedIn) return;
            
            database.ref('orders').orderByChild('shippingInfo/phone').equalTo(state.customerPhone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        state.orderHistory = Object.entries(snapshot.val()).map(([key, value]) => {
                            return { id: key, ...value, type: 'order' };
                        });
                    }
                });
        }

        // Toggle full catalog view
        function toggleFullCatalog() {
            catalogFullList.classList.toggle('active');
            if (catalogFullList.classList.contains('active')) {
                loadFullCatalog();
                allCatalogBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Catalog';
            } else {
                allCatalogBtn.innerHTML = '<i class="fas fa-list"></i> All Catalog';
            }
        }

        // Load full catalog with all products
        function loadFullCatalog() {
            if (state.products.length === 0) return;
            
            let catalogHTML = '<ul>';
            
            // Group products by category
            const productsByCategory = {};
            state.products.forEach(product => {
                if (!productsByCategory[product.category]) {
                    productsByCategory[product.category] = [];
                }
                productsByCategory[product.category].push(product);
            });
            
            // Generate HTML for each category and its products
            Object.keys(productsByCategory).forEach(category => {
                catalogHTML += `<li><strong>${category}</strong></li>`;
                productsByCategory[category].forEach(product => {
                    catalogHTML += `
                        <li>
                            <a href="#" class="catalog-product-link" data-id="${product.id}">
                                <i class="fas fa-arrow-right"></i> ${product.name} - MVR ${product.price.toFixed(2)}
                            </a>
                        </li>
                    `;
                });
            });
            
            catalogHTML += '</ul>';
            catalogFullList.innerHTML = catalogHTML;
            
            // Add event listeners to product links
            document.querySelectorAll('.catalog-product-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const productId = link.dataset.id;
                    viewProductDetail(productId);
                    closeCatalogMenu();
                });
            });
        }

        // Open product modal
        function openProductModal(content) {
            modalContent.innerHTML = content;
            productModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close product modal
        function closeProductModal() {
            productModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Open catalog menu
        function openCatalogMenu() {
            catalogMenu.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close catalog menu
        function closeCatalogMenu() {
            catalogMenu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
            catalogFullList.classList.remove('active');
            allCatalogBtn.innerHTML = '<i class="fas fa-list"></i> All Catalog';
        }

        // Open mobile menu
        function openMobileMenu() {
            mobileNav.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close mobile menu
        function closeMobileMenu() {
            mobileNav.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Load shipping settings from Firebase
        function loadShippingSettings() {
            database.ref('shippingSettings').on('value', (snapshot) => {
                const settings = snapshot.val();
                if (settings) {
                    state.freeShippingThreshold = settings.freeShippingThreshold || 100;
                    state.shippingCost = settings.shippingCost || 5.99;
                }
            });
        }

        // Calculate shipping cost based on order total
        function calculateShipping(subtotal) {
            if (subtotal >= state.freeShippingThreshold) {
                return 0;
            }
            return state.shippingCost;
        }

        // Load catalog name from Firebase
        function loadCatalogName() {
            database.ref('catalogName').on('value', (snapshot) => {
                const name = snapshot.val();
                if (name) {
                    state.catalogName = name;
                }
            });
        }

        // Load categories from Firebase
        function loadCategories() {
            database.ref('categories').on('value', (snapshot) => {
                const categoriesData = snapshot.val();
                if (categoriesData) {
                    state.categories = Object.values(categoriesData);
                    renderCategories();
                    renderCatalogMenu();
                }
            });
        }

        // Render categories in navigation
        function renderCategories() {
            if (state.categories.length > 0) {
                let mobileCategoriesHTML = '';
                
                state.categories.forEach(category => {
                    mobileCategoriesHTML += `
                        <li><a href="#" class="mobile-nav-link" data-page="products" data-category="${category}">
                            <i class="fas fa-${getCategoryIcon(category)}"></i> ${category}
                        </a></li>
                    `;
                });
                
                mobileDynamicCategories.innerHTML = mobileCategoriesHTML;
                
                // Add event listeners to mobile category links
                document.querySelectorAll('#mobileDynamicCategories .mobile-nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        state.currentCategory = link.dataset.category;
                        state.currentSearch = '';
                        loadPage('products');
                        closeMobileMenu();
                    });
                });
            }
        }

        // Render catalog menu
        function renderCatalogMenu() {
            if (state.categories.length > 0) {
                let catalogHTML = '';
                
                state.categories.forEach(category => {
                    catalogHTML += `
                        <li><a href="#" class="catalog-link" data-page="products" data-category="${category}">
                            <i class="fas fa-${getCategoryIcon(category)}"></i> ${category}
                        </a></li>
                    `;
                });
                
                catalogList.innerHTML = catalogHTML;
                
                // Add event listeners to catalog links
                document.querySelectorAll('.catalog-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        state.currentCategory = link.dataset.category;
                        state.currentSearch = '';
                        loadPage('products');
                        closeCatalogMenu();
                    });
                });
            }
        }

        // Get appropriate icon for category
        function getCategoryIcon(category) {
            const categoryIcons = {
                'Fresh Juices': 'glass',
                'Smoothies': 'blender',
                'Detox Cleanses': 'leaf',
                'Boosters': 'bolt',
                'Wellness Shots': 'heart'
            };
            
            return categoryIcons[category] || 'tag';
        }

        // Load smoothies from Firebase
        function loadSmoothies() {
            database.ref('smoothies').on('value', (snapshot) => {
                const smoothiesData = snapshot.val();
                if (smoothiesData) {
                    // Convert object to array
                    state.smoothies = Object.keys(smoothiesData).map(key => {
                        return { id: key, ...smoothiesData[key] };
                    });
                    
                    // If no smoothies in Firebase, add some sample smoothies
                    if (state.smoothies.length === 0) {
                        addSampleSmoothies();
                    }
                } else {
                    // If no smoothies node exists, add sample smoothies
                    addSampleSmoothies();
                }
            });
        }

        // Add sample smoothies to Firebase
        function addSampleSmoothies() {
            const sampleSmoothies = [
                {
                    name: 'Green Detox Smoothie',
                    price: 139,
                    original_price: 159,
                    description: 'Packed with nutrient-rich greens and fruits to help cleanse your system and boost your energy',
                    image: 'https://images.unsplash.com/photo-1553530666-ba11a7da3888?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    category: 'Smoothies',
                    featured: true
                },
                {
                    name: 'Tropical Paradise',
                    price: 129,
                    original_price: 149,
                    description: 'Escape to a Tropical Paradise with this delicious blend of mango, pineapple, coconut milk, and passion fruit',
                    image: 'https://images.unsplash.com/photo-1571934811356-5cc061b6821f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    category: 'Smoothies',
                    featured: true
                }
            ];

            // Add each smoothie to Firebase
            sampleSmoothies.forEach(smoothie => {
                database.ref('smoothies').push(smoothie);
            });
        }

        // Load products from Firebase
        function loadProducts() {
            database.ref('products').on('value', (snapshot) => {
                const productsData = snapshot.val();
                if (productsData) {
                    // Convert object to array
                    state.products = Object.keys(productsData).map(key => {
                        return { id: key, ...productsData[key] };
                    });
                    
                    // If no products in Firebase, add some sample products
                    if (state.products.length === 0) {
                        addSampleProducts();
                    } else {
                        if (state.currentPage) {
                            loadPage(state.currentPage);
                        }
                    }
                } else {
                    // If no products node exists, add sample products
                    addSampleProducts();
                }
            });
        }

        // Add sample products to Firebase
        function addSampleProducts() {
            const sampleProducts = [
                {
                    name: 'Citrus Blast',
                    price: 119,
                    original_price: 129,
                                        image: 'https://images.unsplash.com/photo-1613478223719-2ab802602423?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Refreshing blend of orange, grapefruit, and lemon with a hint of turmeric',
                    category: 'Fresh Juices',
                    featured: true
                },
                {
                    name: 'Berry Antioxidant',
                    price: 149,
                    original_price: 169,
                    image: 'https://images.unsplash.com/photo-1623844889320-6f04dacf3cc4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Packed with mixed berries, banana, Greek yogurt, and honey',
                    category: 'Smoothies',
                    featured: true
                },
                {
                    name: 'Ginger Shot',
                    price: 49,
                    original_price: 59,
                    image: 'https://images.unsplash.com/photo-1598034791475-787a8c4a61a8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Powerful immune-boosting shot with fresh ginger, lemon, and a hint of turmeric',
                    category: 'Wellness Shots',
                    featured: true
                },
                {
                    name: 'Green Cleanse',
                    price: 159,
                    original_price: 179,
                    image: 'https://images.unsplash.com/photo-1615478503562-ec2d8aa0e24e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Deep cleansing juice with kale, cucumber, celery, green apple, and lemon',
                    category: 'Detox Cleanses',
                    featured: true
                },
                {
                    name: 'Protein Power',
                    price: 159,
                    original_price: 179,
                                        image: 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Fuel your body with banana, peanut butter, protein powder, and almond milk',
                    category: 'Smoothies',
                    featured: false
                },
                {
                    name: 'Immunity Booster',
                    price: 89,
                    original_price: 99,
                    image: 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80',
                    description: 'Vitamin C packed shot with orange, lemon, ginger, and echinacea',
                    category: 'Boosters',
                    featured: false
                }
            ];

            // Add each product to Firebase
            sampleProducts.forEach(product => {
                database.ref('products').push(product);
            });
        }

        // Load discount percentage from Firebase
        function loadDiscount() {
            database.ref('discount').on('value', (snapshot) => {
                const discountData = snapshot.val();
                state.discountPercentage = discountData?.percentage || 0;
                
                if (state.currentPage === 'home') {
                    loadPage('home');
                }
            });
        }

        // Load guest house availability
        function loadGuestHouseAvailability() {
            database.ref('guestHouseAvailability').on('value', (snapshot) => {
                const availabilityData = snapshot.val();
                if (availabilityData) {
                    state.guestHouseAvailability = availabilityData;
                }
            });
        }

        // Check if a date is available
        function isDateAvailable(date) {
            const dateString = date.toISOString().split('T')[0];
            return !state.guestHouseAvailability[dateString] || 
                   state.guestHouseAvailability[dateString].available;
        }

        // Check if a time slot is available for events
        function isTimeSlotAvailable(date, time, eventType) {
            const dateString = date.toISOString().split('T')[0];
            const key = `${dateString}_${time}_${eventType}`;
            
            // Check if this time slot is already booked
            return database.ref('eventBookings').orderByChild('dateTimeKey').equalTo(key).once('value')
                .then(snapshot => {
                    return !snapshot.exists();
                });
        }

        // Load a page based on state
        function loadPage(page) {
            state.currentPage = page;
            
            // Check if user needs to be logged in for this page
            const protectedPages = ['cart', 'checkout', 'points', 'guest-house', 'booking', 'history'];
            if (protectedPages.includes(page) && !state.isLoggedIn) {
                authModal.classList.add('active');
                return;
            }
            
            switch(page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'products':
                    renderProductsPage();
                    break;
                case 'product':
                    renderProductDetailPage();
                    break;
                case 'cart':
                    renderCartPage();
                    break;
                case 'checkout':
                    renderCheckoutPage();
                    break;
                case 'guest-house':
                    renderGuestHousePage();
                    break;
                case 'booking':
                    renderBookingPage();
                    break;
                case 'history':
                    renderHistoryPage();
                    break;
                case 'order-status':
                    renderOrderStatusPage();
                    break;
                case 'points':
                    renderPointsPage();
                    break;
                case 'location':
                    renderLocationPage();
                    break;
                case 'pending-review':
                    renderPendingReviewPage();
                    break;
                case 'order-confirmation':
                    renderOrderConfirmationPage();
                    break;
                case 'points-checkout':
                    renderPointsCheckoutPage();
                    break;
                case 'redemption-confirmation':
                    renderRedemptionConfirmationPage();
                    break;
                case 'booking-confirmation':
                    renderBookingConfirmationPage();
                    break;
                default:
                    renderHomePage();
            }
            
            // Update active nav link
            updateActiveNavLink();
            
            // Scroll to top when page changes
            window.scrollTo(0, 0);
            
            // Close mobile menu if open
            closeMobileMenu();
        }

        // Apply discount to price
        function applyDiscount(price) {
            if (state.discountPercentage > 0) {
                return price * (1 - state.discountPercentage / 100);
            }
            return price;
        }

        // Render home page with enhanced banner slideshow
        function renderHomePage() {
            const featuredProducts = state.products.filter(product => product.featured);
            
            mainContent.innerHTML = `
                <section class="banner">
                    <div class="slideshow">
                        <!-- Slide 1 -->
                        <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1613478223719-2ab802602423?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80')">
                            <div class="banner-content">
                                <div class="banner-text">
                                    <h2>Fresh Juice Bar!</h2>
                                    <p>Up to ${state.discountPercentage}% off selected items</p>
                                    <a href="#" class="btn" id="saleBtn">Shop Now</a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Slide 2 -->
                        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1615478503562-ec2d8aa0e24e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80')">
                            <div class="banner-content">
                                <div class="banner-text">
                                    <h2>New Arrivals</h2>
                                    <p>Discover our latest juices and smoothies</p>
                                    <a href="#" class="btn" id="newArrivalsBtn">Explore</a>
                                </div>
                            </div>
                        </div>

                        <!-- Slide 3 -->
                        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1600353068440-6361ef3a86e8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80')">
                            <div class="banner-content">
                                <div class="banner-text">
                                    <h2>Free Delivery</h2>
                                    <p>On all orders over MVR${state.freeShippingThreshold}</p>
                                    <a href="#" class="btn" id="shippingBtn">Learn More</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="categories">
                    <h2>Shop by Category</h2>
                    <div class="category-grid">
                        ${state.categories.length > 0 ? 
                            state.categories.map(category => `
                                <div class="category-item" data-page="products" data-category="${category}">
                                    <img src="${getCategoryImage(category)}" alt="${category}">
                                    <div class="category-overlay">
                                        <div class="category-title">${category}</div>
                                    </div>
                                    <h3>${category}</h3>
                                </div>
                            `).join('') :
                            '<p>No categories available</p>'
                        }
                    </div>
                </section>

                <section class="featured-products">
                    <h2>Featured Products</h2>
                    <div class="product-grid">
                        ${featuredProducts.length > 0 ? 
                            featuredProducts.map(product => {
                                const discountedPrice = applyDiscount(product.price);
                                return `
                                <div class="product-card" data-id="${product.id}">
                                    <img src="${product.image}" alt="${product.name}">
                                    <div class="product-overlay">
                                        <div class="product-actions-overlay">
                                            <button class="btn add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                        </div>
                                    </div>
                                    <h3>${product.name}</h3>
                                    <div class="price">
                                        <span class="current-price">MVR${discountedPrice.toFixed(2)}</span>
                                        ${state.discountPercentage > 0 ? 
                                            `<span class="original-price">MVR${product.price.toFixed(2)}</span>` : ''}
                                    </div>
                                </div>
                                `;
                            }).join('') :
                            '<p>No featured products available.</p>'
                        }
                    </div>
                </section>

                <section style="text-align: center; padding: 40px 20px; margin-top: 40px;">
                    <h2>Scorpiora Guest House</h2>
                    <p style="max-width: 800px; margin: 0 auto 30px; font-size: 18px;">
                        Experience the perfect blend of comfort and convenience at our beautifully appointed guest house. 
                        Whether you're visiting for business or leisure, we provide exceptional service and amenities to make your stay memorable.
                    </p>
                    <a href="#" class="btn" id="guestHouseBtn">Explore Guest House</a>
                </section>
            `;

            // Initialize slideshow
            initSlideshow();

            // Add event listeners to dynamically created elements
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    state.currentCategory = item.dataset.category;
                    state.currentSearch = '';
                    loadPage('products');
                });
            });

            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('add-to-cart-btn')) {
                        const productId = card.dataset.id;
                        viewProductDetail(productId);
                    }
                });
            });

            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.dataset.id;
                    addToCart(productId);
                    alert('Product added to cart!');
                });
            });

            document.getElementById('saleBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                state.currentCategory = null;
                state.currentSearch = '';
                loadPage('products');
            });

            document.getElementById('newArrivalsBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                state.currentCategory = 'Fresh Juices';
                state.currentSearch = '';
                loadPage('products');
            });

            document.getElementById('shippingBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert(`Free delivery applies to all orders over MVR${state.freeShippingThreshold}. No code needed!`);
            });

            document.getElementById('guestHouseBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('guest-house');
            });
        }

        // Get appropriate image for category
        function getCategoryImage(category) {
            // Default placeholder image
            let image = 'https://via.placeholder.com/300x200?text=' + category;
            
            // Map specific categories to their images
            const categoryImages = {
                'Fresh Juices': 'https://images.unsplash.com/photo-1613478223719-2ab802602423?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60',
                'Smoothies': 'https://images.unsplash.com/photo-1571934811356-5cc061b6821f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60',
                'Detox Cleanses': 'https://images.unsplash.com/photo-1615478503562-ec2d8aa0e24e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60',
                'Boosters': 'https://images.unsplash.com/photo-1553530666-ba11a7da3888?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60',
                'Wellness Shots': 'https://images.unsplash.com/photo-1598034791475-787a8c4a61a8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
            };

            if (categoryImages[category]) {
                image = categoryImages[category];
            }

            return image;
        }

        // Initialize slideshow
        function initSlideshow() {
            const slides = document.querySelectorAll('.slide');
            let currentSlide = 0;

            function nextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }

            // Change slide every 5 seconds
            setInterval(nextSlide, 5000);
        }

        // Render products page
        function renderProductsPage() {
            let filteredProducts = [...state.products];

            if (state.currentCategory) {
                filteredProducts = filteredProducts.filter(
                    product => product.category === state.currentCategory
                );
            }

            if (state.currentSearch) {
                const searchTerm = state.currentSearch.toLowerCase();
                filteredProducts = filteredProducts.filter(
                    product => product.name.toLowerCase().includes(searchTerm) || 
                               (product.description && product.description.toLowerCase().includes(searchTerm))
                );
            }

            mainContent.innerHTML = `
                <h1>${state.currentCategory ? state.currentCategory : 'Our Products'}</h1>

                <div class="product-listing">
                    <div class="product-grid">
                        ${filteredProducts.length > 0 ? 
                            filteredProducts.map(product => {
                                const discountedPrice = applyDiscount(product.price);
                                return `
                                <div class="product-card" data-id="${product.id}">
                                    <img src="${product.image}" alt="${product.name}">
                                    <div class="product-overlay">
                                        <div class="product-actions-overlay">
                                            <button class="btn add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                        </div>
                                    </div>
                                    <h3>${product.name}</h3>
                                    <div class="price">
                                        <span class="current-price">MVR${discountedPrice.toFixed(2)}</span>
                                        ${state.discountPercentage > 0 ? 
                                            `<span class="original-price">MVR${product.price.toFixed(2)}</span>` : ''}
                                    </div>
                                </div>
                                `;
                            }).join('') :
                            '<p>No products found matching your criteria.</p>'
                        }
                    </div>
                </div>
            `;

            // Add event listeners
            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('add-to-cart-btn')) {
                        const productId = card.dataset.id;
                        viewProductDetail(productId);
                    }
                });
            });

            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.dataset.id;
                    addToCart(productId);
                    alert('Product added to cart!');
                });
            });
        }

        // View product detail
        function viewProductDetail(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;

            const discountedPrice = applyDiscount(product.price);

            const modalHTML = `
                <div class="product-detail">
                    <div class="product-image">
                        <button class="close-detail" id="closeDetailModal">
                            <i class="fas fa-times"></i>
                        </button>
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <h1>${product.name}</h1>
                        <div class="product-price">
                            MVR${discountedPrice.toFixed(2)}
                            ${state.discountPercentage > 0 ? 
                                `<span class="original-price">MVR${product.price.toFixed(2)}</span>` : ''}
                        </div>
                        <div class="product-description">
                            <p>${product.description}</p>
                        </div>
                        
                        <form id="addToCartForm">
                            <div class="quantity-selector">
                                <label for="quantity">Quantity:</label>
                                <input type="number" name="quantity" id="quantity" value="1" min="1">
                            </div>
                            <button type="submit" class="btn">Add to Cart</button>
                        </form>
                    </div>
                </div>
            `;

            openProductModal(modalHTML);

            document.getElementById('closeDetailModal').addEventListener('click', () => {
                closeProductModal();
            });

            document.getElementById('addToCartForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const quantity = parseInt(document.getElementById('quantity').value) || 1;
                addToCart(product.id, quantity);
                alert(`${product.name} has been added to your cart!`);
                closeProductModal();
            });
        }

        // Render cart page
        function renderCartPage() {
            const cartItems = Object.entries(state.cart)
                .map(([id, quantity]) => {
                    // Check if it's a smoothie first
                    const smoothie = state.smoothies.find(s => s.id === id);
                    if (smoothie) {
                        return {
                            product: smoothie,
                            quantity,
                            isSmoothie: true
                        };
                    }
                    
                    // Otherwise check regular products
                    const product = state.products.find(p => p.id === id);
                    if (!product) return null;
                    
                    return {
                        product,
                        quantity,
                        isSmoothie: false
                    };
                })
                .filter(item => item !== null);

            const subtotal = cartItems.reduce((sum, item) => 
                sum + (item.product.price * item.quantity), 0);

            const shipping = calculateShipping(subtotal);
            const total = subtotal + shipping;

            mainContent.innerHTML = `
                <h1>Your Shopping Cart</h1>
                <p style="margin-bottom: 15px;">Total items: ${Object.values(state.cart).reduce((a, b) => a + b, 0)}</p>
                
                <div class="cart-items">
                    ${cartItems.length > 0 ? 
                        cartItems.map(item => `
                            <div class="cart-item">
                                <img src="${item.product.image}" 
                                     alt="${item.product.name}" class="cart-item-image">
                                <div class="cart-item-details">
                                    <h3>${item.product.name}</h3>
                                    <div class="cart-item-price">
                                        MVR${item.product.price.toFixed(2)} x ${item.quantity}
                                    </div>
                                    <div class="cart-item-quantity">
                                        <button class="decrease-qty" data-id="${item.product.id}">-</button>
                                        <input type="number" value="${item.quantity}" min="1" class="qty-input" data-id="${item.product.id}">
                                        <button class="increase-qty" data-id="${item.product.id}">+</button>
                                    </div>
                                    <button class="btn remove-from-cart-btn" data-id="${item.product.id}">Remove</button>
                                </div>
                                <div>
                                    MVR${(item.product.price * item.quantity).toFixed(2)}
                                </div>
                            </div>
                        `).join('') :
                        '<p>Your cart is empty.</p>'
                    }
                </div>
                
                ${cartItems.length > 0 ? `
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>MVR${subtotal.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Delivery:</span>
                        <span>${shipping === 0 ? 'FREE' : `MVR${shipping.toFixed(2)}`}</span>
                    </div>
                    ${shipping === 0 ? `
                    <div class="summary-row">
                        <span style="color: #4CAF50; font-size: 14px;">
                            <i class="fas fa-check-circle"></i> Free delivery applied!
                        </span>
                    </div>
                    ` : `
                                        <div class="summary-row">
                        <span style="font-size: 14px;">
                            Spend MVR${(state.freeShippingThreshold - subtotal).toFixed(2)} more for free delivery
                        </span>
                    </div>
                    `}
                    <div class="summary-row summary-total">
                        <span>Total:</span>
                        <span>MVR${total.toFixed(2)}</span>
                    </div>
                    <button class="btn" id="checkoutBtn" style="width: 100%; margin-top: 20px;">Proceed to Checkout</button>
                </div>
                ` : ''}
            `;

            // Add event listeners
            document.querySelectorAll('.remove-from-cart-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = btn.dataset.id;
                    removeFromCart(productId);
                });
            });

            document.querySelectorAll('.decrease-qty').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.dataset.id;
                    const currentQty = state.cart[productId];
                    if (currentQty > 1) {
                        updateCartItemQty(productId, currentQty - 1);
                    } else {
                        removeFromCart(productId);
                    }
                });
            });

            document.querySelectorAll('.increase-qty').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.dataset.id;
                    const currentQty = state.cart[productId];
                    updateCartItemQty(productId, currentQty + 1);
                });
            });

            document.querySelectorAll('.qty-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const productId = e.target.dataset.id;
                    const newQty = parseInt(e.target.value) || 1;
                    updateCartItemQty(productId, newQty);
                });
            });

            document.getElementById('checkoutBtn')?.addEventListener('click', () => {
                loadPage('checkout');
            });
        }

        // Update cart item quantity
        function updateCartItemQty(productId, quantity) {
            if (quantity < 1) {
                removeFromCart(productId);
                return;
            }

            state.cart[productId] = quantity;
            saveCart();
            updateCartCount();
            renderCartPage();
        }

        // Render checkout page - IMPROVED FORM
        function renderCheckoutPage() {
            const cartItems = Object.entries(state.cart)
                .map(([id, quantity]) => {
                    // Check if it's a smoothie first
                    const smoothie = state.smoothies.find(s => s.id === id);
                    if (smoothie) {
                        return {
                            product: smoothie,
                            quantity,
                            isSmoothie: true
                        };
                    }
                    
                    // Otherwise check regular products
                    const product = state.products.find(p => p.id === id);
                    if (!product) return null;
                    
                    return {
                        product,
                        quantity,
                        isSmoothie: false
                    };
                })
                .filter(item => item !== null);

            if (cartItems.length === 0) {
                loadPage('cart');
                return;
            }

            const subtotal = cartItems.reduce((sum, item) => 
                sum + (item.product.price * item.quantity), 0);
            const shipping = calculateShipping(subtotal);
            const total = subtotal + shipping;

            // Generate a random order number
            const orderNumber = 'ORD-' + Math.floor(100000 + Math.random() * 900000);

            // Save order details to state
            state.orderDetails = {
                orderNumber,
                items: cartItems,
                subtotal,
                shipping,
                total,
                date: new Date().toLocaleDateString(),
                status: 'pending'
            };

            mainContent.innerHTML = `
                <h1>Checkout</h1>
                <p style="margin-bottom: 15px;">Total items: ${Object.values(state.cart).reduce((a, b) => a + b, 0)}</p>
                
                <div class="checkout-columns">
                    <div class="form-section">
                        <h2>Shipping Information</h2>
                        <form id="shippingForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fullName">Full Name *</label>
                                    <input type="text" id="fullName" value="${state.customerName}" required>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone Number *</label>
                                    <input type="tel" id="phone" value="${state.customerPhone}" required>
                                </div>
                                <div class="form-group">
                                    <label for="address">Address *</label>
                                    <input type="text" id="address" required>
                                </div>
                                <div class="form-group">
                                    <label for="island">Island *</label>
                                    <select id="island" required>
                                        <option value="">Select Island</option>
                                        <option>S.Hithadhoo</option>
                                        <option>S.Maradhoo</option>
                                        <option>S.MaradhooFeydhoo</option>
                                        <option>S.Feydhoo</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="form-section">
                        <h2>Payment Method</h2>
                        
                        <div class="payment-method selected" id="bankTransferMethod">
                            <label>
                                <input type="radio" name="payment" value="bank_transfer" checked>
                                Bank Transfer
                                <img src="https://cdn-icons-png.flaticon.com/512/3690/3690256.png" class="payment-logo" alt="Bank Transfer">
                            </label>
                            <div class="payment-method-details">
                                <div style="margin-top: 10px;">
                                    <div class="bank-info">
                                        <p><strong>Bank Name:</strong> Bank Of Maldives</p>
                                        <p><strong>Account Name:</strong> SCORPIORA</p>
                                        <p><strong>Account Number:</strong> <span class="bank-account-number" id="accountNumber">7770000203219</span></p>
                                        <p><strong>Reference:</strong> ${orderNumber}</p>
                                    </div>
                                    <p style="margin: 10px 0;">Please upload your payment slip after completing the bank transfer.</p>
                                    
                                    <div class="upload-area" id="uploadArea">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to upload payment slip</p>
                                        <p style="font-size: 12px; color: #666;">(JPEG, PNG or PDF, max 5MB)</p>
                                        <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
                                        <div class="file-name" id="fileName"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h2>Order Summary</h2>
                        ${cartItems.map(item => `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
                                <span>${item.product.name} x ${item.quantity}</span>
                                <span>MVR${(item.product.price * item.quantity).toFixed(2)}</span>
                            </div>
                        `).join('')}
                        
                        <div style="border-top: 1px solid #eee; margin: 10px 0; padding-top: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Subtotal:</span>
                                <span>MVR${subtotal.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Delivery:</span>
                                <span>${shipping === 0 ? 'FREE' : `MVR${shipping.toFixed(2)}`}</span>
                            </div>
                            <div style="display: flex; justify-content: between; font-weight: bold; font-size: 16px;">
                                <span>Total:</span>
                                <span>MVR${total.toFixed(2)}</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-large" id="placeOrderBtn">Place Order</button>
                    </div>
                </div>
            `;

            // Set payment method to bank transfer by default
            state.paymentMethod = 'bank_transfer';

            // File upload handling
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');

            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File size exceeds 5MB limit');
                        return;
                    }
                    
                    const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
                    if (!validTypes.includes(file.type)) {
                        alert('Please upload a JPEG, PNG, or PDF file');
                        return;
                    }
                    
                    // Read the file and convert to base64
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        fileName.textContent = file.name;
                        state.uploadedFile = event.target.result; // Store base64 string
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Account number copy functionality
            const accountNumber = document.getElementById('accountNumber');
            accountNumber.addEventListener('click', () => {
                navigator.clipboard.writeText(accountNumber.textContent)
                    .then(() => {
                        copyNotification.textContent = 'Account number copied to clipboard!';
                        copyNotification.classList.add('show');
                        setTimeout(() => {
                            copyNotification.classList.remove('show');
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            });

            document.getElementById('placeOrderBtn').addEventListener('click', () => {
                if (!document.getElementById('shippingForm').checkValidity()) {
                    alert('Please fill out all required shipping information.');
                    return;
                }
                
                if (state.paymentMethod === 'bank_transfer' && !state.uploadedFile) {
                    alert('Please upload your payment slip for bank transfer.');
                    return;
                }
                
                // Save shipping info to order details
                state.orderDetails.shippingInfo = {
                    name: document.getElementById('fullName').value,
                    address: document.getElementById('address').value,
                    island: document.getElementById('island').value,
                    phone: document.getElementById('phone').value
                };
                
                state.orderDetails.paymentMethod = state.paymentMethod;
                if (state.paymentMethod === 'bank_transfer') {
                    state.orderDetails.paymentSlip = state.uploadedFile; // Store the base64 image
                }
                
                // Save order to Firebase
                database.ref('orders').push(state.orderDetails)
                    .then(() => {
                        // Add points for this order
                        addPointsForOrder(state.customerPhone, total);
                        
                        // Clear cart after successful order
                        state.cart = {};
                        saveCart();
                        updateCartCount();
                        
                        loadPage('pending-review');
                    })
                    .catch(error => {
                        alert('Error placing order: ' + error.message);
                    });
            });
        }

        // Add points for an order
        function addPointsForOrder(phone, orderTotal) {
            // 1 point for every 10 MVR spent
            const pointsEarned = Math.floor(orderTotal / 10);

            // Get current points for this phone number
            database.ref('customerPoints').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        // Update existing customer's points
                        const customerData = Object.entries(snapshot.val())[0];
                        const customerId = customerData[0];
                        const currentPoints = customerData[1].points || 0;
                        
                        database.ref('customerPoints/' + customerId).update({
                            points: currentPoints + pointsEarned,
                            lastOrder: new Date().toISOString()
                        });
                    } else {
                        // Create new customer points record
                        database.ref('customerPoints').push({
                            phone: phone,
                            points: pointsEarned,
                            firstOrder: new Date().toISOString(),
                            lastOrder: new Date().toISOString()
                        });
                    }
                });
        }

        // Render guest house page with enhanced booking system
        function renderGuestHousePage() {
            mainContent.innerHTML = `
                <section class="guest-house-cover">
                    <div class="guest-house-slideshow">
                        <!-- Slide 1 -->
                        <div class="guest-house-slide active" style="background-image: url('${state.guestHouseImages[0]}')"></div>
                        
                        <!-- Slide 2 -->
                        <div class="guest-house-slide" style="background-image: url('${state.guestHouseImages[1]}')"></div>
                        
                        <!-- Slide 3 -->
                        <div class="guest-house-slide" style="background-image: url('${state.guestHouseImages[2]}')"></div>
                    </div>
                    <div class="guest-house-overlay">
                        <h1 class="guest-house-title">Scorpiora Guest House</h1>
                        <p class="guest-house-subtitle">Your Home Away From Home</p>
                        <div class="gallery-button" id="galleryButton">
                            <i class="fas fa-images"></i>
                        </div>
                    </div>
                </section>

                <div class="booking-section">
                    <h2>Book Your Stay</h2>
                    
                    <div class="room-options">
                        ${state.roomTypes.map(room => `
                            <div class="room-option ${state.selectedRoom?.id === room.id ? 'selected' : ''}" data-id="${room.id}">
                                <h4>${room.name}</h4>
                                <p>${room.description}</p>
                                <div class="room-price">MVR ${room.price.toFixed(2)} per night</div>
                                <img src="${room.image}" alt="${room.name}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; margin-top: 10px;">
                            </div>
                        `).join('')}
                    </div>
                    
                    ${state.selectedRoom ? `
                        <div class="form-section">
                            <h3>Select Dates</h3>
                            <div class="date-selection">
                                <div class="form-group">
                                    <label for="checkInDate">Check-in Date *</label>
                                    <input type="date" id="checkInDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="checkOutDate">Check-out Date *</label>
                                    <input type="date" id="checkOutDate" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="numGuests">Number of Guests *</label>
                                <input type="number" id="numGuests" min="1" max="10" value="1" required>
                            </div>
                            
                            <h3 style="margin-top: 20px;">Select Amenities</h3>
                            <div class="amenities-grid">
                                ${state.amenities.map(amenity => `
                                    <div class="amenity-item">
                                        <input type="checkbox" id="amenity-${amenity.id}" value="${amenity.id}" data-price="${amenity.price}">
                                        <label for="amenity-${amenity.id}">${amenity.name} ${amenity.price > 0 ? `(MVR ${amenity.price})` : ''}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="guest-house-summary">
                            <h3>Booking Summary</h3>
                            <div class="summary-item">
                                <span>Room:</span>
                                <span>${state.selectedRoom.name}</span>
                            </div>
                            <div class="summary-item">
                                <span>Nights:</span>
                                <span id="nightsCount">0</span>
                            </div>
                            <div class="summary-item">
                                <span>Room Price:</span>
                                <span id="roomPrice">MVR 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span>Amenities:</span>
                                <span id="amenitiesPrice">MVR 0.00</span>
                            </div>
                            <div class="summary-item summary-total">
                                <span>Total:</span>
                                <span id="totalPrice">MVR 0.00</span>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3>Guest Information</h3>
                            <form id="guestHouseForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="guestName">Full Name *</label>
                                        <input type="text" id="guestName" value="${state.customerName}" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="guestContact">Contact Number *</label>
                                        <input type="tel" id="guestContact" value="${state.customerPhone}" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="idUpload">Upload ID Document *</label>
                                        <div class="upload-area" id="idUploadArea">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Click to upload ID document</p>
                                            <p style="font-size: 12px; color: #666;">(JPEG, PNG or PDF, max 5MB)</p>
                                            <input type="file" id="idFileInput" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
                                            <div class="file-name" id="idFileName"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <h3 style="margin-top: 30px;">Payment Information</h3>
                                
                                <div class="payment-method selected" id="bankTransferMethod">
                                    <label>
                                        <input type="radio" name="payment" value="bank_transfer" checked>
                                        Bank Transfer
                                        <img src="https://cdn-icons-png.flaticon.com/512/3690/3690256.png" class="payment-logo" alt="Bank Transfer">
                                    </label>
                                    <div class="payment-method-details">
                                        <div style="margin-top: 10px;">
                                            <div class="bank-info">
                                                <p><strong>Bank Name:</strong> Bank Of Maldives</p>
                                                <p><strong>Account Name:</strong> SCORPIORA</p>
                                                <p><strong>Account Number:</strong> <span class="bank-account-number" id="bookingAccountNumber">7770000203219</span></p>
                                            </div>
                                            <p style="margin: 10px 0;">Please upload your payment slip after completing the bank transfer.</p>
                                            
                                            <div class="upload-area" id="paymentUploadArea">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Click to upload payment slip</p>
                                                <p style="font-size: 12px; color: #666;">(JPEG, PNG or PDF, max 5MB)</p>
                                                <input type="file" id="paymentFileInput" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
                                                <div class="file-name" id="paymentFileName"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-large" style="margin-top: 30px;">Confirm Booking</button>
                            </form>
                        </div>
                    ` : ''}
                </div>
            `;

            // Initialize slideshow
            initGuestHouseSlideshow();

            // Gallery button event
            document.getElementById('galleryButton').addEventListener('click', openGalleryModal);

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkInDate')?.setAttribute('min', today);
            document.getElementById('checkOutDate')?.setAttribute('min', today);

            // Room selection
            document.querySelectorAll('.room-option').forEach(option => {
                option.addEventListener('click', () => {
                    const roomId = option.dataset.id;
                    state.selectedRoom = state.roomTypes.find(room => room.id === roomId);
                    renderGuestHousePage();
                });
            });

            // Date change events
            const checkInDate = document.getElementById('checkInDate');
            const checkOutDate = document.getElementById('checkOutDate');

            if (checkInDate && checkOutDate) {
                checkInDate.addEventListener('change', updateBookingSummary);
                checkOutDate.addEventListener('change', updateBookingSummary);
                
                // Set check-out date minimum to check-in date
                checkInDate.addEventListener('change', function() {
                    checkOutDate.min = this.value;
                    state.checkInDate = new Date(this.value);
                    if (checkOutDate.value && new Date(checkOutDate.value) <= new Date(this.value)) {
                        checkOutDate.value = '';
                        state.checkOutDate = null;
                    }
                    updateBookingSummary();
                });
                
                checkOutDate.addEventListener('change', function() {
                    state.checkOutDate = new Date(this.value);
                    updateBookingSummary();
                });
            }

            // Amenities change events
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const amenityId = checkbox.value;
                    if (checkbox.checked) {
                        state.selectedAmenities.push(state.amenities.find(a => a.id === amenityId));
                    } else {
                        state.selectedAmenities = state.selectedAmenities.filter(a => a.id !== amenityId);
                    }
                    updateBookingSummary();
                });
            });

            // Number of guests change
            document.getElementById('numGuests')?.addEventListener('change', updateBookingSummary);

            // File upload handling for ID
            const idUploadArea = document.getElementById('idUploadArea');
            const idFileInput = document.getElementById('idFileInput');
            const idFileName = document.getElementById('idFileName');

            if (idUploadArea) {
                idUploadArea.addEventListener('click', () => {
                    idFileInput.click();
                });
                
                idFileInput.addEventListener('change', (e) => {
                    handleFileUpload(e, idFileName);
                });
            }

            // File upload handling for payment
            const paymentUploadArea = document.getElementById('paymentUploadArea');
            const paymentFileInput = document.getElementById('paymentFileInput');
            const paymentFileName = document.getElementById('paymentFileName');

            if (paymentUploadArea) {
                paymentUploadArea.addEventListener('click', () => {
                    paymentFileInput.click();
                });
                
                paymentFileInput.addEventListener('change', (e) => {
                    handleFileUpload(e, paymentFileName);
                });
            }

            // Account number copy functionality
            const accountNumber = document.getElementById('bookingAccountNumber');
            if (accountNumber) {
                accountNumber.addEventListener('click', () => {
                    navigator.clipboard.writeText(accountNumber.textContent)
                        .then(() => {
                            copyNotification.textContent = 'Account number copied to clipboard!';
                            copyNotification.classList.add('show');
                            setTimeout(() => {
                                copyNotification.classList.remove('show');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                        });
                });
            }

            // Form submission
            document.getElementById('guestHouseForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Validate files are uploaded
                if (!idFileInput.files[0]) {
                    alert('Please upload your ID document');
                    return;
                }
                
                if (!paymentFileInput.files[0]) {
                    alert('Please upload your payment slip');
                    return;
                }
                
                // Calculate total
                const nights = Math.ceil((state.checkOutDate - state.checkInDate) / (1000 * 60 * 60 * 24));
                const roomTotal = state.selectedRoom.price * nights;
                const amenitiesTotal = state.selectedAmenities.reduce((sum, amenity) => sum + amenity.price, 0);
                const total = roomTotal + amenitiesTotal;
                
                // Get form values
                const bookingDetails = {
                    name: document.getElementById('guestName').value,
                    contact: document.getElementById('guestContact').value,
                    room: state.selectedRoom.name,
                    checkIn: state.checkInDate.toISOString().split('T')[0],
                    checkOut: state.checkOutDate.toISOString().split('T')[0],
                    nights: nights,
                    guests: parseInt(document.getElementById('numGuests').value),
                    amenities: state.selectedAmenities.map(a => a.name),
                    roomPrice: state.selectedRoom.price,
                    amenitiesTotal: amenitiesTotal,
                    total: total,
                    paymentMethod: 'bank_transfer',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                // Generate booking reference
                const bookingRef = 'GH-' + Math.floor(100000 + Math.random() * 900000);
                bookingDetails.bookingRef = bookingRef;
                
                // Save to Firebase
                database.ref('guestHouseBookings').push(bookingDetails)
                    .then(() => {
                        // Set booking details for confirmation page
                        state.bookingDetails = bookingDetails;
                        
                        loadPage('booking-confirmation');
                    })
                    .catch(error => {
                        alert('Error creating booking: ' + error.message);
                    });
            });

            // Initial summary update
            updateBookingSummary();
        }

        // Update booking summary
        function updateBookingSummary() {
            if (!state.selectedRoom) return;

            const checkInDate = document.getElementById('checkInDate');
            const checkOutDate = document.getElementById('checkOutDate');
            const nightsCount = document.getElementById('nightsCount');
            const roomPrice = document.getElementById('roomPrice');
            const amenitiesPrice = document.getElementById('amenitiesPrice');
            const totalPrice = document.getElementById('totalPrice');

            if (!checkInDate.value || !checkOutDate.value) {
                nightsCount.textContent = '0';
                roomPrice.textContent = 'MVR 0.00';
                amenitiesPrice.textContent = 'MVR 0.00';
                totalPrice.textContent = 'MVR 0.00';
                return;
            }

            // Calculate nights
            const checkIn = new Date(checkInDate.value);
            const checkOut = new Date(checkOutDate.value);
            const nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));

            // Calculate prices
            const roomTotal = state.selectedRoom.price * nights;
            const amenitiesTotal = state.selectedAmenities.reduce((sum, amenity) => sum + amenity.price, 0);
            const total = roomTotal + amenitiesTotal;

            // Update summary
            nightsCount.textContent = nights;
            roomPrice.textContent = `MVR ${roomTotal.toFixed(2)}`;
            amenitiesPrice.textContent = `MVR ${amenitiesTotal.toFixed(2)}`;
            totalPrice.textContent = `MVR ${total.toFixed(2)}`;
        }

        // Initialize guest house slideshow
        function initGuestHouseSlideshow() {
            const slides = document.querySelectorAll('.guest-house-slide');
            let currentSlide = 0;

            function nextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }

            // Change slide every 5 seconds
            if (slides.length > 0) {
                setInterval(nextSlide, 5000);
            }
        }

        // Handle file upload
        function handleFileUpload(e, fileNameElement) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size exceeds 5MB limit');
                    return;
                }
                
                const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
                if (!validTypes.includes(file.type)) {
                    alert('Please upload a JPEG, PNG, or PDF file');
                    return;
                }
                
                fileNameElement.textContent = file.name;
            }
        }

        // Redeem points for a product - FIXED VERSION
        function redeemPointsForProduct(pointsProduct) {
            // Show available products within the price range
            const eligibleProducts = [...state.products, ...state.smoothies].filter(
                product => product && product.price <= pointsProduct.maxValue
            );

            if (eligibleProducts.length === 0) {
                alert('No products available for redemption at this time.');
                return;
            }

            // Clear previous content and show products
            mainContent.innerHTML = `
                <div class="points-section">
                    <h2>Select Product to Redeem</h2>
                    <p>Your ${pointsProduct.points} points can be used for any product under MVR ${pointsProduct.maxValue}</p>
                    
                    <div class="product-grid">
                        ${eligibleProducts.map(product => `
                            <div class="product-card">
                                <img src="${product.image}" alt="${product.name}">
                                <div class="product-overlay">
                                    <div class="product-actions-overlay">
                                        <button class="btn redeem-product-btn" data-id="${product.id}" data-type="${product.hasOwnProperty('ingredients') ? 'smoothie' : 'product'}">Redeem Now</button>
                                    </div>
                                </div>
                                <h3>${product.name}</h3>
                                <div class="price">
                                    <span class="current-price">MVR${product.price.toFixed(2)}</span>
                                </div>
                                </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // Add event listeners for redemption
            document.querySelectorAll('.redeem-product-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = btn.dataset.id;
                    const productType = btn.dataset.type;
                    
                    let product;
                    if (productType === 'smoothie') {
                        product = state.smoothies.find(s => s.id === productId);
                    } else {
                        product = state.products.find(p => p.id === productId);
                    }
                    
                    if (!product) {
                        alert('Sorry, this product is no longer available.');
                        return;
                    }
                    
                    if (confirm(`Redeem ${pointsProduct.points} points for ${product.name}?`)) {
                        // Set points redemption state
                        state.pointsRedemption = true;
                        state.pointsRedemptionProduct = {
                            product: product,
                            pointsProduct: pointsProduct
                        };
                        
                        // Add to cart with fixed quantity of 1 (can't be changed)
                        addToCart(productId, 1, true);
                        
                        // Load points checkout page
                        loadPage('points-checkout');
                    }
                });
            });
        }

// Render points page with working redeem functionality
function renderPointsPage() {
    mainContent.innerHTML = `
        <div class="points-section">
            <h1>Redeem Your Points</h1>
            <p style="margin-bottom: 15px;">Earn 1 point for every MVR 10 spent. Use your points for discounts and free items!</p>
            
            <div class="points-balance" id="pointsBalance">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <input type="tel" id="phoneCheck" placeholder="Enter your phone number" value="${state.customerPhone || ''}" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; flex: 1;">
                    <button class="btn" id="checkPointsBtn">Check Points</button>
                </div>
                <div id="pointsResult"></div>
            </div>
            
            <div class="redeem-section">
                <h2>Redeem Your Points</h2>
                <p>Select a reward to redeem using your points:</p>
                
                <div class="redeem-options">
                    ${state.pointsProducts.map(product => `
                        <div class="redeem-option" data-id="${product.id}">
                            <img src="${product.image}" alt="${product.name}" style="width: 60px; height: 60px; object-fit: contain; margin-bottom: 10px;">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="points-cost">${product.points} points</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;

    // Check points button event
    document.getElementById('checkPointsBtn').addEventListener('click', () => {
        const phone = document.getElementById('phoneCheck').value.trim();
        
        if (!phone) {
            alert('Please enter your phone number');
            return;
        }
        
        checkCustomerPoints(phone);
    });

    // Redeem option selection - FIXED
    document.querySelectorAll('.redeem-option').forEach(option => {
        option.addEventListener('click', () => {
            if (!state.customerPhone) {
                alert('Please check your points balance first');
                return;
            }
            
            const productId = option.dataset.id;
            const pointsProduct = state.pointsProducts.find(p => p.id === productId);
            
            // Debug log to check if product is found
            console.log('Selected product:', pointsProduct);
            
            if (!pointsProduct) {
                alert('Product not found. Please try again.');
                return;
            }
            
            if (state.customerPoints < pointsProduct.points) {
                alert(`You don't have enough points. You need ${pointsProduct.points} points but only have ${state.customerPoints}.`);
                return;
            }
            
            // Handle different redemption types
            if (pointsProduct.maxValue) {
                // Product redemption
                redeemPointsForProduct(pointsProduct);
            } else if (pointsProduct.bookingType) {
                // Booking redemption
                redeemPointsForBooking(pointsProduct);
            }
        });
    });
}

// Redeem points for booking - FIXED VERSION
function redeemPointsForBooking(pointsProduct) {
    console.log('Redeeming points for booking:', pointsProduct);
    
    // Set points redemption state
    state.pointsRedemption = true;
    state.pointsRedemptionProduct = pointsProduct;
    
    console.log('Points redemption product set:', state.pointsRedemptionProduct);

    // Load the appropriate booking page
    if (pointsProduct.bookingType === 'karaoke') {
        state.bookingType = 'karaoke';
        loadPage('booking');
    } else if (pointsProduct.bookingType === 'small-party') {
        state.bookingType = 'small-party';
        loadPage('booking');
    } else {
        console.log('Unknown booking type:', pointsProduct.bookingType);
        alert('Invalid booking type selected.');
    }
}



        // Render booking page (simplified version) with enhanced payment method
function renderBookingPage() {
    mainContent.innerHTML = `
        <h1>Exclusive Reservations</h1>
        <p style="margin-bottom: 15px;">Book our exclusive spaces for your events and gatherings</p>
        
        <div class="booking-options">
            <div class="booking-option karaoke ${state.bookingType === 'karaoke' ? 'selected' : ''}" data-type="karaoke">
                <i class="fas fa-microphone"></i>
                <h3>Karaoke Room</h3>
                <p>Private karaoke room for up to 10 people</p>
            </div>
            <div class="booking-option small-party ${state.bookingType === 'small-party' ? 'selected' : ''}" data-type="small-party">
                <i class="fas fa-glass-cheers"></i>
                <h3>Small Party</h3>
                <p>Space for small gatherings and celebrations</p>
            </div>
            <div class="booking-option office-gathering" data-type="office-gathering">
                <i class="fas fa-briefcase"></i>
                <h3>Office Gathering</h3>
                <p>Perfect for team meetings and office events</p>
            </div>
            <div class="booking-option private-event" data-type="private-event">
                <i class="fas fa-crown"></i>
                <h3>Private Event</h3>
                <p>Exclusive space for private events</p>
            </div>
        </div>
        
        <div class="booking-form ${state.bookingType ? 'active' : ''}" id="bookingForm">
            <h2>Booking Request Form</h2>
            <form id="bookingRequestForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="bookingName">Full Name *</label>
                        <input type="text" id="bookingName" value="${state.customerName}" required>
                    </div>
                    <div class="form-group">
                        <label for="bookingPhone">Phone Number *</label>
                        <input type="tel" id="bookingPhone" value="${state.customerPhone}" required>
                    </div>
                    <div class="form-group">
                        <label for="bookingType">Event Type *</label>
                        <input type="text" id="bookingType" value="${state.bookingType ? state.bookingType.replace('-', ' ') : ''}" readonly required>
                    </div>
                    
                    ${state.bookingType ? `
                        <div class="form-group">
                            <label for="bookingDate">Preferred Date *</label>
                            <input type="date" id="bookingDate" required>
                        </div>
                        <div class="form-group">
                            <label for="bookingTime">Preferred Time *</label>
                            <input type="time" id="bookingTime" required>
                        </div>
                        
                        ${state.bookingType === 'karaoke' || state.bookingType === 'small-party' ? `
                            <div class="form-group">
                                <label for="duration">Duration (Hours) *</label>
                                <div class="duration-options" id="durationOptions">
                                    ${state.eventPricing[state.bookingType].map(option => `
                                        <div class="duration-option" data-hours="${option.hours}" data-price="${option.price}">
                                            ${option.hours} hour${option.hours > 1 ? 's' : ''} - MVR ${option.price}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="event-pricing" id="eventPricing" style="display: none;">
                                <h3>Pricing Summary</h3>
                                <div class="pricing-row">
                                    <span>Base Price:</span>
                                    <span id="basePrice">MVR 0</span>
                                </div>
                                <div class="pricing-row pricing-total">
                                    <span>Total:</span>
                                    <span id="pricingTotal">MVR 0</span>
                                </div>
                            </div>
                        ` : ''}
                    ` : ''}
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="bookingNotes">Additional Notes</label>
                        <textarea id="bookingNotes" placeholder="Tell us about your event..."></textarea>
                    </div>
                </div>
                
                <!-- Payment Method Section -->
                <div class="form-section">
                    <h2>Payment Method</h2>
                    
                    <div class="payment-method selected" id="bankTransferMethod">
                        <label>
                            <input type="radio" name="payment" value="bank_transfer" checked>
                            Bank Transfer
                            <img src="https://cdn-icons-png.flaticon.com/512/3690/3690256.png" class="payment-logo" alt="Bank Transfer">
                        </label>
                        <div class="payment-method-details">
                            <div style="margin-top: 10px;">
                                <div class="bank-info">
                                    <p><strong>Bank Name:</strong> Bank Of Maldives</p>
                                    <p><strong>Account Name:</strong> SCORPIORA</p>
                                    <p><strong>Account Number:</strong> <span class="bank-account-number" id="bookingAccountNumber">7770000203219</span></p>
                                </div>
                                <p style="margin: 10px 0;">Please upload your payment slip after completing the bank transfer.</p>
                                
                                <div class="upload-area" id="bookingUploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload payment slip</p>
                                    <p style="font-size: 12px; color: #666;">(JPEG, PNG or PDF, max 5MB)</p>
                                    <input type="file" id="bookingFileInput" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
                                    <div class="file-name" id="bookingFileName"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${state.pointsRedemption ? `
                    <div class="registration-prompt">
                        <h3>Points Redemption</h3>
                        <p>You are redeeming ${state.pointsRedemptionProduct.points} points for this booking.</p>
                        <p>The booking will be free of charge.</p>
                    </div>
                ` : ''}
                
                <button type="submit" class="btn btn-large">${state.pointsRedemption ? 'Redeem Points & Book' : 'Submit Booking Request'}</button>
            </form>
        </div>
        
       
    `;

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('bookingDate')?.setAttribute('min', today);

    // Booking option selection
    document.querySelectorAll('.booking-option').forEach(option => {
        option.addEventListener('click', () => {
            document.querySelectorAll('.booking-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            const bookingType = option.dataset.type;
            state.bookingType = bookingType;
            document.getElementById('bookingType').value = bookingType.replace(/-/g, ' ');
            
            // Show booking form
            document.getElementById('bookingForm').classList.add('active');
            
            // Re-render to show duration options
            renderBookingPage();
        });
    });

    // Duration selection
    const durationOptions = document.getElementById('durationOptions');
    if (durationOptions) {
        durationOptions.addEventListener('click', (e) => {
            if (e.target.classList.contains('duration-option')) {
                document.querySelectorAll('.duration-option').forEach(opt => opt.classList.remove('selected'));
                e.target.classList.add('selected');
                
                const hours = parseInt(e.target.dataset.hours);
                const price = parseInt(e.target.dataset.price);
                state.selectedEventDuration = { hours, price };
                
                // Show pricing summary
                const eventPricing = document.getElementById('eventPricing');
                eventPricing.style.display = 'block';
                
                document.getElementById('basePrice').textContent = `MVR ${price}`;
                document.getElementById('pricingTotal').textContent = `MVR ${price}`;
            }
        });
    }

    // File upload handling for booking payment
    const uploadArea = document.getElementById('bookingUploadArea');
    const fileInput = document.getElementById('bookingFileInput');
    const fileName = document.getElementById('bookingFileName');

    if (uploadArea) {
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size exceeds 5MB limit');
                    return;
                }
                
                const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
                if (!validTypes.includes(file.type)) {
                    alert('Please upload a JPEG, PNG, or PDF file');
                    return;
                }
                
                fileName.textContent = file.name;
                // Store file for later use
                state.bookingPaymentFile = file;
            }
        });
    }

    // Account number copy functionality
    const accountNumber = document.getElementById('bookingAccountNumber');
    if (accountNumber) {
        accountNumber.addEventListener('click', () => {
            navigator.clipboard.writeText(accountNumber.textContent)
                .then(() => {
                    copyNotification.textContent = 'Account number copied to clipboard!';
                    copyNotification.classList.add('show');
                    setTimeout(() => {
                        copyNotification.classList.remove('show');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        });
    }

    // Form submission
    document.getElementById('bookingRequestForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Validate payment file upload
        if (!state.pointsRedemption && !state.bookingPaymentFile) {
            alert('Please upload your payment slip for bank transfer.');
            return;
        }
        
        const bookingDetails = {
            name: document.getElementById('bookingName').value,
            phone: document.getElementById('bookingPhone').value,
            type: document.getElementById('bookingType').value,
            date: document.getElementById('bookingDate').value,
            time: document.getElementById('bookingTime').value,
            notes: document.getElementById('bookingNotes').value,
            status: 'pending',
            submittedAt: new Date().toISOString(),
            paymentMethod: 'bank_transfer'
        };
        
        // Add duration and pricing if applicable
        if (state.selectedEventDuration) {
            bookingDetails.duration = state.selectedEventDuration.hours;
            bookingDetails.price = state.selectedEventDuration.price;
            bookingDetails.total = state.selectedEventDuration.price;
        }
        
        // Generate booking reference
        const bookingRef = 'BK-' + Math.floor(100000 + Math.random() * 900000);
        bookingDetails.bookingRef = bookingRef;
        
        // Check if the selected date and time is available
        isTimeSlotAvailable(new Date(bookingDetails.date), bookingDetails.time, state.bookingType)
            .then(isAvailable => {
                if (!isAvailable) {
                    alert('Sorry, this time slot is already booked. Please choose a different date or time.');
                    return;
                }
                
                // Create a unique key for this booking
                bookingDetails.dateTimeKey = `${bookingDetails.date}_${bookingDetails.time}_${state.bookingType}`;
                
                // Handle points redemption
                if (state.pointsRedemption) {
                    // Deduct points from customer
                    database.ref('customerPoints').orderByChild('phone').equalTo(state.customerPhone).once('value')
                        .then(snapshot => {
                            if (snapshot.exists()) {
                                const customerData = Object.entries(snapshot.val())[0];
                                const customerId = customerData[0];
                                const currentPoints = customerData[1].points || 0;
                                
                                if (currentPoints >= state.pointsRedemptionProduct.points) {
                                    // Update points
                                    database.ref('customerPoints/' + customerId).update({
                                        points: currentPoints - state.pointsRedemptionProduct.points
                                    }).then(() => {
                                        // Save booking
                                        saveBooking(bookingDetails, true);
                                    });
                                } else {
                                    alert('You don\'t have enough points for this redemption.');
                                }
                            }
                        });
                } else {
                    // Regular booking
                    saveBooking(bookingDetails, false);
                }
            })
            .catch(error => {
                alert('Error checking availability: ' + error.message);
            });
    });

    function saveBooking(bookingDetails, isPointsRedemption) {
        database.ref('bookingRequests').push(bookingDetails)
            .then(() => {
                if (isPointsRedemption) {
                    alert('Your booking has been confirmed using your points! We will contact you shortly.');
                    // Reset points redemption state
                    state.pointsRedemption = false;
                    state.pointsRedemptionProduct = null;
                } else {
                    alert('Your booking request has been submitted! We will contact you shortly to confirm.');
                }
                
                // Reload booking history
                loadBookingHistory();
                loadPage('booking');
            })
            .catch(error => {
                alert('Error submitting booking request: ' + error.message);
            });
    }
}

        // Render history page with both orders and bookings
        function renderHistoryPage() {
            mainContent.innerHTML = `
                <h1>Your History</h1>
                <p style="margin-bottom: 15px;">View your order and booking history</p>
                
                <div class="history-section">
                    <div class="history-tabs">
                        <div class="history-tab active" data-tab="orders">Orders</div>
                        <div class="history-tab" data-tab="bookings">Bookings</div>
                    </div>
                    
                    <div class="history-content active" id="ordersHistory">
                        <h2>Order History</h2>
                        ${state.orderHistory.length > 0 ? 
                            state.orderHistory.map(order => `
                                <div class="history-item">
                                    <div class="history-item-header">
                                        <div>
                                            <span class="booking-ref">${order.orderNumber}</span>
                                            <span class="history-item-date">${order.date}</span>
                                        </div>
                                        <span class="booking-status status-${order.status}">${order.status}</span>
                                    </div>
                                    <div class="history-item-details">
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Items:</span>
                                            <span>${order.items.map(item => `${item.product.name} x${item.quantity}`).join(', ')}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Total:</span>
                                            <span>MVR ${order.total.toFixed(2)}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Payment:</span>
                                            <span>${order.paymentMethod}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Status:</span>
                                            <span>${order.status}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<div class="no-history"><p>No order history found.</p></div>'
                        }
                    </div>
                    
                    <div class="history-content" id="bookingsHistory">
                        <h2>Booking History</h2>
                        ${state.bookingHistory.length > 0 ? 
                            state.bookingHistory.map(booking => `
                                <div class="history-item">
                                    <div class="history-item-header">
                                        <div>
                                            <span class="booking-ref">${booking.bookingRef || booking.id.substring(0,8)}</span>
                                            <span class="history-item-date">${new Date(booking.createdAt || booking.submittedAt).toLocaleDateString()}</span>
                                        </div>
                                        <span class="booking-status status-${booking.status}">${booking.status}</span>
                                    </div>
                                    <div class="history-item-details">
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Type:</span>
                                            <span>${booking.type || booking.room || 'Event Booking'}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Date:</span>
                                            <span>${booking.date || booking.checkIn}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Total:</span>
                                            <span>MVR ${booking.total || booking.price || 0}</span>
                                        </div>
                                        <div class="history-item-detail">
                                            <span class="history-item-detail-label">Status:</span>
                                            <span>${booking.status}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<div class="no-history"><p>No booking history found.</p></div>'
                        }
                    </div>
                </div>
            `;

            // Tab switching functionality
            const historyTabs = document.querySelectorAll('.history-tab');
            const historyContents = document.querySelectorAll('.history-content');

            historyTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // Update active tab
                    historyTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    historyContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabName}History`).classList.add('active');
                });
            });
        }

        // Render location page with Google Maps
        function renderLocationPage() {
            mainContent.innerHTML = `
                <div class="location-section">
                    <h2>Our Location</h2>
                    <p style="margin-bottom: 15px;">Visit us at our store for the freshest juices and smoothies!</p>
                    
                    <div class="map-container">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1012.6683292569796!2d73.09563745811272!3d-0.6125645494069025!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x24b59fdbf46f56d5%3A0xa326174f7d67ca9f!2sAddu%20City%20Square!5e1!3m2!1sen!2smv!4v1756636690037!5m2!1sen!2smv" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                    
                    <div class="location-info">
                        <div class="location-details">
                            <h3>Store Information</h3>
                            <p><i class="fas fa-map-marker-alt"></i> Hithadhoo, Addu City, Maldives</p>
                            <p><i class="fas fa-phone"></i> <a href="tel:+9607933305">+960 7933305</a></p>
                            <p><i class="fas fa-clock"></i> Open Daily: 8:00 AM - 10:00 PM</p>
                            
                            <h3 style="margin-top: 20px;">Delivery Areas</h3>
                            <p>We deliver to all islands in Addu Atoll:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>S. Hithadhoo</li>
                                <li>S. Maradhoo</li>
                                <li>S. Maradhoo-Feydhoo</li>
                                <li>S. Feydhoo</li>
                                <li>S. Hulhudhoo</li>
                                <li>S. Meedhoo</li>
                            </ul>
                        </div>
                        
                        <div class="location-details">
                            <h3>Get Directions</h3>
                            <p>Enter your location to get directions to our store:</p>
                            <div style="margin-top: 15px;">
                                <input type="text" id="directionsFrom" placeholder="Enter your location" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                                                               <button class="btn" id="getDirectionsBtn">Get Directions</button>
                            </div>
                            <div id="directionsPanel" style="margin-top: 15px; padding: 15px; background-color: #f9f9f9; border-radius: 4px; display: none;"></div>
                        </div>
                    </div>
                </div>
            `;

            // Get directions button event
            document.getElementById('getDirectionsBtn').addEventListener('click', () => {
                const from = document.getElementById('directionsFrom').value;
                if (from) {
                    window.open(`https://www.google.com/maps/dir/${encodeURIComponent(from)}/Addu+City+Square,+Hithadhoo,+Maldives/`, '_blank');
                } else {
                    alert('Please enter your location');
                }
            });
        }

        // Render order status page
        function renderOrderStatusPage() {
            mainContent.innerHTML = `
                <h1>Order Status Tracker</h1>
                <p style="margin-bottom: 15px;">Enter your order reference number to check the status of your order or booking</p>
                
                <div class="order-status">
                    <div class="status-tracker-form">
                        <input type="text" id="orderReference" placeholder="Enter your order/booking reference number">
                        <button class="btn" id="trackOrderBtn">Track Status</button>
                    </div>
                    
                    <div id="orderStatusResult" style="display: none;">
                        <div class="status-timeline">
                            <div class="status-step">
                                <div class="status-icon active" id="statusOrdered">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="status-label">Ordered</div>
                            </div>
                            <div class="status-step">
                                <div class="status-icon" id="statusPreparing">
                                    <i class="fas fa-blender"></i>
                                </div>
                                <div class="status-label">Preparing</div>
                            </div>
                            <div class="status-step">
                                <div class="status-icon" id="statusOnTheWay">
                                    <i class="fas fa-motorcycle"></i>
                                </div>
                                <div class="status-label">On the Way</div>
                            </div>
                            <div class="status-step">
                                <div class="status-icon" id="statusDelivered">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="status-label">Delivered</div>
                            </div>
                        </div>

                        <div id="orderDetails" style="background-color: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 20px;"></div>
                    </div>
                </div>
            `;

            // Track order button event
            document.getElementById('trackOrderBtn').addEventListener('click', () => {
                const orderRef = document.getElementById('orderReference').value.trim();
                
                if (!orderRef) {
                    alert('Please enter your order reference number');
                    return;
                }
                
                trackOrderStatus(orderRef);
            });
        }

        // Track order status
        function trackOrderStatus(orderRef) {
            // First check if it's a regular order
            database.ref('orders').orderByChild('orderNumber').equalTo(orderRef).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const orderData = Object.values(snapshot.val())[0];
                        displayOrderStatus(orderRef, orderData, 'order');
                    } else {
                        // If not found in orders, check guest house bookings
                        database.ref('guestHouseBookings').orderByChild('bookingRef').equalTo(orderRef).once('value')
                            .then(guestHouseSnapshot => {
                                if (guestHouseSnapshot.exists()) {
                                    const guestHouseData = Object.values(guestHouseSnapshot.val())[0];
                                    displayOrderStatus(orderRef, guestHouseData, 'guesthouse');
                                } else {
                                    // If not found in guest house bookings, check event bookings
                                    database.ref('bookingRequests').orderByChild('bookingRef').equalTo(orderRef).once('value')
                                        .then(bookingSnapshot => {
                                            if (bookingSnapshot.exists()) {
                                                const bookingData = Object.values(bookingSnapshot.val())[0];
                                                displayOrderStatus(orderRef, bookingData, 'booking');
                                            } else {
                                                displayOrderNotFound(orderRef);
                                            }
                                        });
                                }
                            });
                    }
                })
                .catch(error => {
                    alert('Error tracking order: ' + error.message);
                });
        }

        // Display order status
        function displayOrderStatus(orderRef, orderData, type) {
            const orderStatusResult = document.getElementById('orderStatusResult');
            const orderDetails = document.getElementById('orderDetails');

            // Show order status result
            orderStatusResult.style.display = 'block';

            // Update status timeline based on type
            if (type === 'order') {
                updateStatusIcons(orderData.status);
                
                // Display order details
                orderDetails.innerHTML = `
                    <h3>Order Details: ${orderRef}</h3>
                    <p><strong>Order Date:</strong> ${orderData.date}</p>
                    <p><strong>Status:</strong> ${orderData.status}</p>
                    <p><strong>Total Amount:</strong> MVR${orderData.total.toFixed(2)}</p>
                    <p><strong>Shipping Address:</strong> ${orderData.shippingInfo.address}, ${orderData.shippingInfo.island}</p>
                    <p><strong>Contact:</strong> ${orderData.shippingInfo.phone}</p>
                    
                    <h4 style="margin-top: 15px;">Items:</h4>
                    ${orderData.items.map(item => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${item.product.name} x ${item.quantity}</span>
                            <span>MVR${(item.product.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `).join('')}
                `;
            } else if (type === 'guesthouse') {
                // For guest house bookings, show different status icons
                updateBookingStatusIcons(orderData.status);
                
                orderDetails.innerHTML = `
                    <h3>Guest House Booking Details: ${orderRef}</h3>
                    <p><strong>Booking Date:</strong> ${new Date(orderData.createdAt).toLocaleDateString()}</p>
                    <p><strong>Status:</strong> ${orderData.status}</p>
                    <p><strong>Guest:</strong> ${orderData.name}</p>
                    <p><strong>Contact:</strong> ${orderData.contact}</p>
                    <p><strong>Room:</strong> ${orderData.room}</p>
                    <p><strong>Check-in:</strong> ${orderData.checkIn}</p>
                    <p><strong>Check-out:</strong> ${orderData.checkOut}</p>
                    <p><strong>Guests:</strong> ${orderData.guests}</p>
                    ${orderData.amenities && orderData.amenities.length > 0 ? `
                        <p><strong>Amenities:</strong> ${orderData.amenities.join(', ')}</p>
                    ` : ''}
                    <p><strong>Total Amount:</strong> MVR ${orderData.total.toFixed(2)}</p>
                `;
            } else if (type === 'booking') {
                // For event bookings
                updateBookingStatusIcons(orderData.status);
                
                orderDetails.innerHTML = `
                    <h3>Event Booking Details: ${orderRef}</h3>
                    <p><strong>Booking Date:</strong> ${new Date(orderData.submittedAt).toLocaleDateString()}</p>
                    <p><strong>Status:</strong> ${orderData.status}</p>
                    <p><strong>Event Type:</strong> ${orderData.type}</p>
                    <p><strong>Date:</strong> ${orderData.date}</p>
                    <p><strong>Time:</strong> ${orderData.time}</p>
                    ${orderData.duration ? `<p><strong>Duration:</strong> ${orderData.duration} hours</p>` : ''}
                    ${orderData.total ? `<p><strong>Total Amount:</strong> MVR ${orderData.total.toFixed(2)}</p>` : ''}
                    <p><strong>Contact:</strong> ${orderData.phone}</p>
                `;
            }
        }

        // Display order not found
        function displayOrderNotFound(orderRef) {
            const orderStatusResult = document.getElementById('orderStatusResult');
            const orderDetails = document.getElementById('orderDetails');

            orderStatusResult.style.display = 'block';
            orderDetails.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-circle" style="font-size: 48px; color: #ff6b6b;"></i>
                    <h3>Order Not Found</h3>
                    <p>No order found with reference number: ${orderRef}</p>
                    <p>Please check your reference number and try again.</p>
                </div>
            `;
        }

        // Update status icons based on order status
        function updateStatusIcons(status) {
            // Reset all icons
            document.getElementById('statusOrdered').classList.remove('active');
            document.getElementById('statusPreparing').classList.remove('active');
            document.getElementById('statusOnTheWay').classList.remove('active');
            document.getElementById('statusDelivered').classList.remove('active');

            // Activate icons based on status
            document.getElementById('statusOrdered').classList.add('active');

            if (status === 'preparing' || status === 'on-the-way' || status === 'delivered') {
                document.getElementById('statusPreparing').classList.add('active');
            }

            if (status === 'on-the-way' || status === 'delivered') {
                document.getElementById('statusOnTheWay').classList.add('active');
            }

            if (status === 'delivered') {
                document.getElementById('statusDelivered').classList.add('active');
            }
        }

        // Update booking status icons
        function updateBookingStatusIcons(status) {
            // Reset all icons
            document.getElementById('statusOrdered').classList.remove('active');
            document.getElementById('statusPreparing').classList.remove('active');
            document.getElementById('statusOnTheWay').classList.remove('active');
            document.getElementById('statusDelivered').classList.remove('active');

            // Update labels for bookings
            document.querySelectorAll('.status-label')[0].textContent = 'Booked';
            document.querySelectorAll('.status-label')[1].textContent = 'Confirmed';
            document.querySelectorAll('.status-label')[2].textContent = 'In Progress';
            document.querySelectorAll('.status-label')[3].textContent = 'Completed';

            // Activate icons based on status
            document.getElementById('statusOrdered').classList.add('active');

            if (status === 'confirmed' || status === 'in-progress' || status === 'completed') {
                document.getElementById('statusPreparing').classList.add('active');
            }

            if (status === 'in-progress' || status === 'completed') {
                document.getElementById('statusOnTheWay').classList.add('active');
            }

            if (status === 'completed') {
                document.getElementById('statusDelivered').classList.add('active');
            }
        }

        // Render pending review page
        function renderPendingReviewPage() {
            if (!state.orderDetails) {
                loadPage('home');
                return;
            }

            mainContent.innerHTML = `
                <div class="pending-review">
                    <i class="fas fa-clock"></i>
                    <h1>Order Pending Review</h1>
                    <p>Your order <strong>${state.orderDetails.orderNumber}</strong> has been received and is pending payment verification.</p>
                    <p>We will process your order once we verify your bank transfer.</p>
                    <p>You will receive a confirmation SMS once your order is approved.</p>
                    
                    <div class="order-details">
                        <h3>Order Summary</h3>
                        <div class="order-details-row">
                            <span class="order-details-label">Order Number:</span>
                            <span>${state.orderDetails.orderNumber}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Order Date:</span>
                            <span>${state.orderDetails.date}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Total Amount:</span>
                            <span>MVR${state.orderDetails.total.toFixed(2)}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Payment Method:</span>
                            <span>Bank Transfer</span>
                        </div>
                    </div>
                    
                    <a href="#" class="btn" id="backToHomeBtn">Back to Home</a>
                </div>
            `;

            document.getElementById('backToHomeBtn').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('home');
            });
        }

        // Render order confirmation page
        function renderOrderConfirmationPage() {
            if (!state.orderDetails) {
                loadPage('home');
                return;
            }

            mainContent.innerHTML = `
                <div class="order-confirmation">
                    <i class="fas fa-check-circle"></i>
                    <h1>Order Confirmed!</h1>
                    <p>Thank you for your order. Your order has been confirmed and will be processed shortly.</p>
                    
                    <div class="order-details">
                        <h3>Order Details</h3>
                        <div class="order-details-row">
                            <span class="order-details-label">Order Number:</span>
                            <span>${state.orderDetails.orderNumber}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Total Amount:</span>
                            <span>MVR${state.orderDetails.total.toFixed(2)}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Payment Method:</span>
                            <span>Bank Transfer</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Estimated Delivery:</span>
                            <span>30-45 minutes</span>
                        </div>
                    </div>
                    
                    <p>You will receive an SMS with order tracking details shortly.</p>
                    
                    <a href="#" class="btn" id="trackOrderBtnConfirm">Track Your Order</a>
                    <a href="#" class="btn btn-secondary" id="backToHomeBtnConfirm">Back to Home</a>
                </div>
            `;

            document.getElementById('backToHomeBtnConfirm').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('home');
            });

            document.getElementById('trackOrderBtnConfirm').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('order-status');
            });
        }

        // Render points checkout page
        function renderPointsCheckoutPage() {
            if (!state.pointsRedemption || !state.pointsRedemptionProduct) {
                loadPage('points');
                return;
            }

            const cartItems = Object.entries(state.cart)
                .map(([id, quantity]) => {
                    // Check if it's a smoothie first
                    const smoothie = state.smoothies.find(s => s.id === id);
                    if (smoothie) {
                        return {
                            product: smoothie,
                            quantity,
                            isSmoothie: true
                        };
                    }
                    
                    // Otherwise check regular products
                    const product = state.products.find(p => p.id === id);
                    if (!product) return null;
                    
                    return {
                        product,
                        quantity,
                        isSmoothie: false
                    };
                })
                .filter(item => item !== null);

            if (cartItems.length === 0) {
                loadPage('points');
                return;
            }

            mainContent.innerHTML = `
                <h1>Points Redemption Checkout</h1>
                <p style="margin-bottom: 15px;">You are redeeming ${state.pointsRedemptionProduct.points} points for your selected product.</p>
                
                <div class="cart-items">
                    ${cartItems.map(item => `
                        <div class="cart-item">
                            <img src="${item.product.image}" 
                                 alt="${item.product.name}" class="cart-item-image">
                            <div class="cart-item-details">
                                <h3>${item.product.name}</h3>
                                <div class="cart-item-price">
                                    MVR${item.product.price.toFixed(2)} x ${item.quantity}
                                </div>
                            </div>
                            <div>
                                MVR${(item.product.price * item.quantity).toFixed(2)}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="registration-prompt">
                    <h3>Points Redemption</h3>
                    <p>You are redeeming ${state.pointsRedemptionProduct.points} points for this product.</p>
                    <p>The product will be free of charge.</p>
                </div>
                
                <div class="form-section">
                    <h2>Shipping Information</h2>
                    <form id="pointsShippingForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="pointsFullName">Full Name *</label>
                                <input type="text" id="pointsFullName" value="${state.customerName}" required>
                            </div>
                            <div class="form-group">
                                <label for="pointsPhone">Phone Number *</label>
                                <input type="tel" id="pointsPhone" value="${state.customerPhone}" required>
                            </div>
                            <div class="form-group">
                                <label for="pointsAddress">Address *</label>
                                <input type="text" id="pointsAddress" required>
                            </div>
                            <div class="form-group">
                                <label for="pointsIsland">Island *</label>
                                <select id="pointsIsland" required>
                                    <option value="">Select Island</option>
                                    <option>S.Hithadhoo</option>
                                    <option>S.Maradhoo</option>
                                    <option>S.MaradhooFeydhoo</option>
                                    <option>S.Feydhoo</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                
                <button class="btn btn-large" id="redeemPointsBtn">Redeem Points & Place Order</button>
            `;

            document.getElementById('redeemPointsBtn').addEventListener('click', () => {
                if (!document.getElementById('pointsShippingForm').checkValidity()) {
                    alert('Please fill out all required shipping information.');
                    return;
                }
                
                // Deduct points from customer
                database.ref('customerPoints').orderByChild('phone').equalTo(state.customerPhone).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            const customerData = Object.entries(snapshot.val())[0];
                            const customerId = customerData[0];
                            const currentPoints = customerData[1].points || 0;
                            
                            if (currentPoints >= state.pointsRedemptionProduct.points) {
                                // Update points
                                database.ref('customerPoints/' + customerId).update({
                                    points: currentPoints - state.pointsRedemptionProduct.points
                                }).then(() => {
                                    // Create order record
                                    const orderDetails = {
                                        orderNumber: 'POINTS-' + Math.floor(100000 + Math.random() * 900000),
                                        items: cartItems,
                                        subtotal: 0,
                                        shipping: 0,
                                        total: 0,
                                        date: new Date().toLocaleDateString(),
                                        status: 'confirmed',
                                        shippingInfo: {
                                            name: document.getElementById('pointsFullName').value,
                                            address: document.getElementById('pointsAddress').value,
                                            island: document.getElementById('pointsIsland').value,
                                            phone: document.getElementById('pointsPhone').value
                                        },
                                        paymentMethod: 'points_redemption',
                                        pointsUsed: state.pointsRedemptionProduct.points
                                    };
                                    
                                    // Save order to Firebase
                                    database.ref('orders').push(orderDetails)
                                        .then(() => {
                                            // Clear cart after successful order
                                            state.cart = {};
                                            saveCart();
                                            updateCartCount();
                                            
                                            // Reset points redemption state
                                            state.pointsRedemption = false;
                                            state.pointsRedemptionProduct = null;
                                            
                                            loadPage('redemption-confirmation');
                                        });
                                });
                            } else {
                                alert('You don\'t have enough points for this redemption.');
                            }
                        }
                    });
            });
        }

        // Render redemption confirmation page
        function renderRedemptionConfirmationPage() {
            mainContent.innerHTML = `
                <div class="redemption-confirmation">
                    <i class="fas fa-check-circle"></i>
                    <h1>Redemption Successful!</h1>
                    <p>Your points have been successfully redeemed for your product.</p>
                    <p>The product will be delivered to your address shortly.</p>
                    
                    <div class="reference-number">
                        Thank you for choosing Scorpiora!
                    </div>
                    
                    <a href="#" class="btn" id="backToHomeBtnRedemption">Back to Home</a>
                </div>
            `;

            document.getElementById('backToHomeBtnRedemption').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('home');
            });
        }

        // Render booking confirmation page
        function renderBookingConfirmationPage() {
            if (!state.bookingDetails) {
                loadPage('home');
                return;
            }

            mainContent.innerHTML = `
                <div class="booking-confirmation">
                    <i class="fas fa-check-circle"></i>
                    <h1>Booking Confirmed!</h1>
                    <p>Your booking has been successfully confirmed.</p>
                    
                    <div class="booking-details">
                        <h3>Booking Details</h3>
                        <div class="order-details-row">
                            <span class="order-details-label">Booking Reference:</span>
                            <span>${state.bookingDetails.bookingRef}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Guest Name:</span>
                            <span>${state.bookingDetails.name}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Room Type:</span>
                            <span>${state.bookingDetails.room}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Check-in:</span>
                            <span>${state.bookingDetails.checkIn}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label>Check-out:</span>
                            <span>${state.bookingDetails.checkOut}</span>
                        </div>
                        <div class="order-details-row">
                            <span class="order-details-label">Total Amount:</span>
                            <span>MVR ${state.bookingDetails.total.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <p>You will receive a confirmation SMS with all the details shortly.</p>
                    
                    <a href="#" class="btn" id="backToHomeBtnBooking">Back to Home</a>
                </div>
            `;

            document.getElementById('backToHomeBtnBooking').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('home');
            });
        }

        // Update active navigation link
        function updateActiveNavLink() {
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Add active class to current page link
            document.querySelectorAll(`.nav-link[data-page="${state.currentPage}"]`).forEach(link => {
                link.classList.add('active');
            });

            // Update page title
            const pageTitles = {
                'home': 'Home',
                'products': 'Our Products',
                'product': 'Product Details',
                'cart': 'Shopping Cart',
                'checkout': 'Checkout',
                'guest-house': 'Guest House',
                'booking': 'Bookings',
                'history': 'History',
                'order-status': 'Order Status',
                'points': 'Redeem Points',
                'location': 'Location',
                'pending-review': 'Order Pending',
                'order-confirmation': 'Order Confirmed',
                'points-checkout': 'Points Checkout',
                'redemption-confirmation': 'Redemption Confirmed',
                'booking-confirmation': 'Booking Confirmed'
            };

            document.title = `${pageTitles[state.currentPage] || 'Scorpiora'} | ${state.catalogName}`;
        }

        // Add product to cart
        function addToCart(productId, quantity = 1, isPointsRedemption = false) {
            if (state.cart[productId] && !isPointsRedemption) {
                state.cart[productId] += quantity;
            } else {
                state.cart[productId] = quantity;
            }

            saveCart();
            updateCartCount();
        }

        // Remove product from cart
        function removeFromCart(productId) {
            delete state.cart[productId];
            saveCart();
            updateCartCount();
            renderCartPage();
        }

        // Save cart to localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(state.cart));
        }

        // Update cart count badge
        function updateCartCount() {
            const count = Object.values(state.cart).reduce((a, b) => a + b, 0);
            cartCount.textContent = count;

            if (count > 0) {
                cartCount.style.display = 'flex';
            } else {
                cartCount.style.display = 'none';
            } 
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
    
</body>
</html>